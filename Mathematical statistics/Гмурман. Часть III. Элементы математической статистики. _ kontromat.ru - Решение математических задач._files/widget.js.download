var jSH=function(){function e(e){return null==e?String(e):Z[q.call(e)]||"object"}function t(t){return"function"==e(t)}function i(e){return null!=e&&e==e.window}function n(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function s(t){return"object"==e(t)}function r(e){return s(e)&&!i(e)&&e.__proto__==Object.prototype}function a(e){return e instanceof Array}function o(e){return"number"==typeof e.length}function l(e){return $.call(e,function(e){return null!=e})}function c(e){return e.length>0?k.fn.concat.apply([],e):e}function h(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function d(e){return e in A?A[e]:A[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function u(e,t){return"number"!=typeof t||N[h(e)]?t:t+"px"}function f(e){var t,i;return C[e]||(t=W.createElement(e),W.body.appendChild(t),i=P(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==i&&(i="block"),C[e]=i),C[e]}function p(e){return"children"in e?O.call(e.children):k.map(e.childNodes,function(e){return 1==e.nodeType?e:void 0})}function v(e,t,i){for(H in t)i&&(r(t[H])||a(t[H]))?(r(t[H])&&!r(e[H])&&(e[H]={}),a(t[H])&&!a(e[H])&&(e[H]=[]),v(e[H],t[H],i)):t[H]!==b&&(e[H]=t[H])}function _(e,t){return t===b?k(e):k(e).filter(t)}function m(e,i,n,s){return t(i)?i.call(e,n,s):i}function g(e,t,i){null==i?e.removeAttribute(t):e.setAttribute(t,i)}function S(e,t){var i=e.className,n=i&&i.baseVal!==b;return t===b?n?i.baseVal:i:void(n?i.baseVal=t:e.className=t)}function w(e){var t;try{return e?"true"==e||("false"==e?!1:"null"==e?null:isNaN(t=Number(e))?/^[\[\{]/.test(e)?k.parseJSON(e):e:t):e}catch(i){return e}}function y(e,t){t(e);for(var i in e.childNodes)y(e.childNodes[i],t)}var b,H,k,x,I,E,T=[],O=T.slice,$=T.filter,W=window.document,C={},A={},P=W.defaultView.getComputedStyle,N={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},j=/^\s*<(\w+|!)[^>]*>/,z=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,M=/^(?:body|html)$/i,D=["val","css","html","text","data","width","height","offset"],R=["after","prepend","before","append"],G=W.createElement("table"),L=W.createElement("tr"),F={tr:W.createElement("tbody"),tbody:G,thead:G,tfoot:G,td:L,th:L,"*":W.createElement("div")},V=/complete|loaded|interactive/,B=/^\.([\w-]+)$/,J=/^#([\w-]*)$/,U=/^[\w-]+$/,Z={},q=Z.toString,Y={},X=W.createElement("div");return Y.matches=function(e,t){if(!e||1!==e.nodeType)return!1;var i=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(i)return i.call(e,t);var n,s=e.parentNode,r=!s;return r&&(s=X).appendChild(e),n=~Y.qsa(s,t).indexOf(e),r&&X.removeChild(e),n},I=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},E=function(e){return $.call(e,function(t,i){return e.indexOf(t)==i})},Y.fragment=function(e,t,i){e.replace&&(e=e.replace(z,"<$1></$2>")),t===b&&(t=j.test(e)&&RegExp.$1),t in F||(t="*");var n,s,a=F[t];return a.innerHTML=""+e,s=k.each(O.call(a.childNodes),function(){a.removeChild(this)}),r(i)&&(n=k(s),k.each(i,function(e,t){D.indexOf(e)>-1?n[e](t):n.attr(e,t)})),s},Y.Z=function(e,t){return e=e||[],e.__proto__=k.fn,e.selector=t||"",e},Y.isZ=function(e){return e instanceof Y.Z},Y.init=function(e,i){if(e){if(t(e))return k(W).ready(e);if(Y.isZ(e))return e;var n;if(a(e))n=l(e);else if(s(e))n=[r(e)?k.extend({},e):e],e=null;else if(j.test(e))n=Y.fragment(e.trim(),RegExp.$1,i),e=null;else{if(i!==b)return k(i).find(e);n=Y.qsa(W,e)}return Y.Z(n,e)}return Y.Z()},k=function(e,t){return Y.init(e,t)},k.extend=function(e){var t,i=O.call(arguments,1);return"boolean"==typeof e&&(t=e,e=i.shift()),i.forEach(function(i){v(e,i,t)}),e},Y.qsa=function(e,t){var i;return n(e)&&J.test(t)?(i=e.getElementById(RegExp.$1))?[i]:[]:1!==e.nodeType&&9!==e.nodeType?[]:O.call(B.test(t)?e.getElementsByClassName(RegExp.$1):U.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t))},k.contains=function(e,t){return e!==t&&e.contains(t)},k.type=e,k.isFunction=t,k.isWindow=i,k.isArray=a,k.isPlainObject=r,k.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},k.inArray=function(e,t,i){return T.indexOf.call(t,e,i)},k.camelCase=I,k.trim=function(e){return e.trim()},k.uuid=0,k.support={},k.expr={},k.map=function(e,t){var i,n,s,r=[];if(o(e))for(n=0;n<e.length;n++)i=t(e[n],n),null!=i&&r.push(i);else for(s in e)i=t(e[s],s),null!=i&&r.push(i);return c(r)},k.each=function(e,t){var i,n;try{if(o(e)){for(i=0;i<e.length;i++)if(t.call(e[i],i,e[i])===!1)return e}else for(n in e)if(t.call(e[n],n,e[n])===!1)return e}catch(s){}return e},k.grep=function(e,t){return $.call(e,t)},window.JSON&&(k.parseJSON=JSON.parse),k.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Z["[object "+t+"]"]=t.toLowerCase()}),k.fn={forEach:T.forEach,reduce:T.reduce,push:T.push,sort:T.sort,indexOf:T.indexOf,concat:T.concat,map:function(e){return k(k.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return k(O.apply(this,arguments))},ready:function(e){return V.test(W.readyState)?e(k):W.addEventListener("DOMContentLoaded",function(){e(k)},!1),this},get:function(e){return e===b?O.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return T.every.call(this,function(t,i){return e.call(t,i,t)!==!1}),this},filter:function(e){return t(e)?this.not(this.not(e)):k($.call(this,function(t){return Y.matches(t,e)}))},add:function(e,t){return k(E(this.concat(k(e,t))))},is:function(e){return this.length>0&&Y.matches(this[0],e)},not:function(e){var i=[];if(t(e)&&e.call!==b)this.each(function(t){e.call(this,t)||i.push(this)});else{var n="string"==typeof e?this.filter(e):o(e)&&t(e.item)?O.call(e):k(e);this.forEach(function(e){n.indexOf(e)<0&&i.push(e)})}return k(i)},has:function(e){return this.filter(function(){return s(e)?k.contains(this,e):k(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!s(e)?e:k(e)},last:function(){var e=this[this.length-1];return e&&!s(e)?e:k(e)},find:function(e){var t,i=this;return t="object"==typeof e?k(e).filter(function(){var e=this;return T.some.call(i,function(t){return k.contains(t,e)})}):1==this.length?k(Y.qsa(this[0],e)):this.map(function(){return Y.qsa(this,e)})},closest:function(e,t){var i=this[0],s=!1;for("object"==typeof e&&(s=k(e));i&&!(s?s.indexOf(i)>=0:Y.matches(i,e));)i=i!==t&&!n(i)&&i.parentNode;return k(i)},parents:function(e){for(var t=[],i=this;i.length>0;)i=k.map(i,function(e){return(e=e.parentNode)&&!n(e)&&t.indexOf(e)<0?(t.push(e),e):void 0});return _(t,e)},parent:function(e){return _(E(this.pluck("parentNode")),e)},children:function(e){return _(this.map(function(){return p(this)}),e)},contents:function(){return this.map(function(){return O.call(this.childNodes)})},siblings:function(e){return _(this.map(function(e,t){return $.call(p(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return k.map(this,function(t){return t[e]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=null),"none"==P(this,"").getPropertyValue("display")&&(this.style.display=f(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var i=t(e);if(this[0]&&!i)var n=k(e).get(0),s=n.parentNode||this.length>1;return this.each(function(t){k(this).wrapAll(i?e.call(this,t):s?n.cloneNode(!0):n)})},wrapAll:function(e){if(this[0]){k(this[0]).before(e=k(e));for(var t;(t=e.children()).length;)e=t.first();k(e).append(this)}return this},wrapInner:function(e){var i=t(e);return this.each(function(t){var n=k(this),s=n.contents(),r=i?e.call(this,t):e;s.length?s.wrapAll(r):n.append(r)})},unwrap:function(){return this.parent().each(function(){k(this).replaceWith(k(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=k(this);(e===b?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return k(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return k(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return e===b?this.length>0?this[0].innerHTML:null:this.each(function(t){var i=this.innerHTML;k(this).empty().append(m(this,e,t,i))})},text:function(e){return e===b?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=e})},attr:function(e,t){var i;return"string"==typeof e&&t===b?0==this.length||1!==this[0].nodeType?b:"value"==e&&"INPUT"==this[0].nodeName?this.val():!(i=this[0].getAttribute(e))&&e in this[0]?this[0][e]:i:this.each(function(i){if(1===this.nodeType)if(s(e))for(H in e)g(this,H,e[H]);else g(this,e,m(this,t,i,this.getAttribute(e)))})},removeAttr:function(e){return this.each(function(){1===this.nodeType&&g(this,e)})},prop:function(e,t){return t===b?this[0]&&this[0][e]:this.each(function(i){this[e]=m(this,t,i,this[e])})},data:function(e,t){var i=this.attr("data-"+h(e),t);return null!==i?w(i):b},val:function(e){return e===b?this[0]&&(this[0].multiple?k(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(t){this.value=m(this,e,t,this.value)})},offset:function(e){if(e)return this.each(function(t){var i=k(this),n=m(this,e,t,i.offset()),s=i.offsetParent().offset(),r={top:n.top-s.top,left:n.left-s.left};"static"==i.css("position")&&(r.position="relative"),i.css(r)});if(0==this.length)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,i){if(arguments.length<2&&"string"==typeof t)return this[0]&&(this[0].style[I(t)]||P(this[0],"").getPropertyValue(t));var n="";if("string"==e(t))i||0===i?n=h(t)+":"+u(t,i):this.each(function(){this.style.removeProperty(h(t))});else for(H in t)t[H]||0===t[H]?n+=h(H)+":"+u(H,t[H])+";":this.each(function(){this.style.removeProperty(h(H))});return this.each(function(){this.style.cssText+=";"+n})},index:function(e){return e?this.indexOf(k(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return T.some.call(this,function(e){return this.test(S(e))},d(e))},addClass:function(e){return this.each(function(t){x=[];var i=S(this),n=m(this,e,t,i);n.split(/\s+/g).forEach(function(e){k(this).hasClass(e)||x.push(e)},this),x.length&&S(this,i+(i?" ":"")+x.join(" "))})},removeClass:function(e){return this.each(function(t){return e===b?S(this,""):(x=S(this),m(this,e,t,x).split(/\s+/g).forEach(function(e){x=x.replace(d(e)," ")}),void S(this,x.trim()))})},toggleClass:function(e,t){return this.each(function(i){var n=k(this),s=m(this,e,i,S(this));s.split(/\s+/g).forEach(function(e){(t===b?!n.hasClass(e):t)?n.addClass(e):n.removeClass(e)})})},scrollTop:function(){return this.length?"scrollTop"in this[0]?this[0].scrollTop:this[0].scrollY:void 0},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),i=this.offset(),n=M.test(t[0].nodeName)?{top:0,left:0}:t.offset();return i.top-=parseFloat(k(e).css("margin-top"))||0,i.left-=parseFloat(k(e).css("margin-left"))||0,n.top+=parseFloat(k(t[0]).css("border-top-width"))||0,n.left+=parseFloat(k(t[0]).css("border-left-width"))||0,{top:i.top-n.top,left:i.left-n.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||W.body;e&&!M.test(e.nodeName)&&"static"==k(e).css("position");)e=e.offsetParent;return e})}},k.fn.detach=k.fn.remove,["width","height"].forEach(function(e){k.fn[e]=function(t){var s,r=this[0],a=e.replace(/./,function(e){return e[0].toUpperCase()});return t===b?i(r)?r["inner"+a]:n(r)?r.documentElement["offset"+a]:(s=this.offset())&&s[e]:this.each(function(i){r=k(this),r.css(e,m(this,t,i,r[e]()))})}}),R.forEach(function(t,i){var n=i%2;k.fn[t]=function(){var t,s,r=k.map(arguments,function(i){return t=e(i),"object"==t||"array"==t||null==i?i:Y.fragment(i)}),a=this.length>1;return r.length<1?this:this.each(function(e,t){s=n?t:t.parentNode,t=0==i?t.nextSibling:1==i?t.firstChild:2==i?t:null,r.forEach(function(e){if(a)e=e.cloneNode(!0);else if(!s)return k(e).remove();y(s.insertBefore(e,t),function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},k.fn[n?t+"To":"insert"+(i?"Before":"After")]=function(e){return k(e)[t](this),this}}),Y.Z.prototype=k.fn,Y.uniq=E,Y.deserializeValue=w,k.zepto=Y,k}();window.jSH=jSH,function(e){function t(e){return e._zid||(e._zid=f++)}function i(e,i,r,a){if(i=n(i),i.ns)var o=s(i.ns);return(u[t(e)]||[]).filter(function(e){return!(!e||i.e&&e.e!=i.e||i.ns&&!o.test(e.ns)||r&&t(e.fn)!==t(r)||a&&e.sel!=a)})}function n(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function s(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function r(t,i,n){"string"!=e.type(t)?e.each(t,n):t.split(/\s/).forEach(function(e){n(e,i)})}function a(e,t){return e.del&&("focus"==e.e||"blur"==e.e)||!!t}function o(e){return v[e]||e}function l(i,s,l,c,h,d){var f=t(i),p=u[f]||(u[f]=[]);r(s,l,function(t,s){var r=n(t);r.fn=s,r.sel=c,r.e in v&&(s=function(t){var i=t.relatedTarget;return!i||i!==this&&!e.contains(this,i)?r.fn.apply(this,arguments):void 0}),r.del=h&&h(s,t);var l=r.del||s;r.proxy=function(e){var t=l.apply(i,[e].concat(e.data));return t===!1&&(e.preventDefault(),e.stopPropagation()),t},r.i=p.length,p.push(r),i.addEventListener(o(r.e),r.proxy,a(r,d))})}function c(e,n,s,l,c){var h=t(e);r(n||"",s,function(t,n){i(e,t,n,l).forEach(function(t){delete u[h][t.i],e.removeEventListener(o(t.e),t.proxy,a(t,c))})})}function h(t){var i,n={originalEvent:t};for(i in t)g.test(i)||void 0===t[i]||(n[i]=t[i]);return e.each(S,function(e,i){n[e]=function(){return this[i]=_,t[e].apply(t,arguments)},n[i]=m}),n}function d(e){if(!("defaultPrevented"in e)){e.defaultPrevented=!1;var t=e.preventDefault;e.preventDefault=function(){this.defaultPrevented=!0,t.call(this)}}}var u=(e.zepto.qsa,{}),f=1,p={},v={mouseenter:"mouseover",mouseleave:"mouseout"};p.click=p.mousedown=p.mouseup=p.mousemove="MouseEvents",e.event={add:l,remove:c},e.proxy=function(i,n){if(e.isFunction(i)){var s=function(){return i.apply(n,arguments)};return s._zid=t(i),s}if("string"==typeof n)return e.proxy(i[n],i);throw new TypeError("expected function")},e.fn.bind=function(e,t){return this.each(function(){l(this,e,t)})},e.fn.unbind=function(e,t){return this.each(function(){c(this,e,t)})},e.fn.one=function(e,t){return this.each(function(i,n){l(this,e,t,null,function(e,t){return function(){var i=e.apply(n,arguments);return c(n,t,e),i}})})};var _=function(){return!0},m=function(){return!1},g=/^([A-Z]|layer[XY]$)/,S={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,i,n){return this.each(function(s,r){l(r,i,n,t,function(i){return function(n){var s,a=e(n.target).closest(t,r).get(0);return a?(s=e.extend(h(n),{currentTarget:a,liveFired:r}),i.apply(a,[s].concat([].slice.call(arguments,1)))):void 0}})})},e.fn.undelegate=function(e,t,i){return this.each(function(){c(this,t,i,e)})},e.fn.live=function(t,i){return e(document.body).delegate(this.selector,t,i),this},e.fn.die=function(t,i){return e(document.body).undelegate(this.selector,t,i),this},e.fn.on=function(t,i,n){return!i||e.isFunction(i)?this.bind(t,i||n):this.delegate(i,t,n)},e.fn.off=function(t,i,n){return!i||e.isFunction(i)?this.unbind(t,i||n):this.undelegate(i,t,n)},e.fn.trigger=function(t,i){return("string"==typeof t||e.isPlainObject(t))&&(t=e.Event(t)),d(t),t.data=i,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(t)})},e.fn.triggerHandler=function(t,n){var s,r;return this.each(function(a,o){s=h("string"==typeof t?e.Event(t):t),s.data=n,s.target=o,e.each(i(o,t.type||t),function(e,t){return r=t.proxy(s),s.isImmediatePropagationStopped()?!1:void 0})}),r},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}}),this}}),e.Event=function(e,t){"string"!=typeof e&&(t=e,e=t.type);var i=document.createEvent(p[e]||"Events"),n=!0;if(t)for(var s in t)"bubbles"==s?n=!!t[s]:i[s]=t[s];return i.initEvent(e,n,!0,null,null,null,null,null,null,null,null,null,null,null,null),i.isDefaultPrevented=function(){return this.defaultPrevented},i}}(jSH),jSH.fn.placeholder=function(){return this.each(function(){})},"Prototype"in window&&(Array.prototype.every=function(e){if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=arguments[1],s=0;i>s;s++)if(s in t&&!e.call(n,t[s],s,t))return!1;return!0}),function(e){function t(t,n){var l=t[o],c=l&&s[l];if(void 0===n)return c||i(t);if(c){if(n in c)return c[n];var h=a(n);if(h in c)return c[h]}return r.call(e(t),n)}function i(t,i,r){var l=t[o]||(t[o]=++e.uuid),c=s[l]||(s[l]=n(t));return void 0!==i&&(c[a(i)]=r),c}function n(t){var i={};return e.each(t.attributes,function(t,n){0==n.name.indexOf("data-")&&(i[a(n.name.replace("data-",""))]=e.zepto.deserializeValue(n.value))}),i}var s={},r=e.fn.data,a=e.camelCase,o=e.expando="Zepto"+ +new Date;e.fn.data=function(n,s){return void 0===s?e.isPlainObject(n)?this.each(function(t,s){e.each(n,function(e,t){i(s,e,t)})}):0==this.length?void 0:t(this[0],n):this.each(function(){i(this,n,s)})},e.fn.removeData=function(t){return"string"==typeof t&&(t=t.split(/\s+/)),this.each(function(){var i=this[o],n=i&&s[i];n&&e.each(t,function(){delete n[a(this)]})})}}(jSH),function(e,t,i,n){var s,r;s=function(e){if(i.d){var t=i.Y+e.pageY-i.pY,s=i.X+e.pageX-i.pX;n.css({left:s,top:t}),n.trigger("dragdrop",[t,s])}else{var r=Math.max(e.pageX-i.pX+i.W,i.mw),a=Math.max(e.pageY-i.pY+i.H,i.mh);n.css({width:r,height:a}),n.trigger("dragresize")}return!1},r=function(){e(t).off("mousemove",s).off("mouseup",r)};var a=function(a,l,c,h){return h=h||{},a.each(function(){l=l?e(l,a):a,l.on("mousedown",function(l){return n=a,i={X:o("left"),Y:o("top"),W:o("width")||E[0].scrollWidth||0,H:o("height")||E[0].scrollHeight||0,pX:l.pageX,pY:l.pageY,d:c,mw:h.mw||0,mh:h.mh||0},e(t).on("mousemove",s).on("mouseup",r),!1})})},o=function(e){return parseInt(n.css(e))||0};e.fn.drag=function(e,t){return a(this,e,!0,t)},e.fn.resize=function(e,t){return a(this,e,!1,t)},e.fn.attach=function(t){t=e.extend({prefix:"sh",id:0,url:"host()/upload/attach",flag:0},t);var i=function(e){var i=e.find("[name=file]"),n={action:"attach_file",dialog:t.id,flag:t.flag};SH.IOApi(t.url,n,function(t){e.prepend(i),i.trigger("uploaded",[t])},{multipart:1,file:i})};return this.each(function(){var n=e(this);n.css({position:"relative"});var s=e("<div></div>").css({position:"absolute",left:0,top:0,overflow:"hidden",zIndex:10}),r=e("<input type='file' name='file' class='"+t.prefix+"_attach_file' />");r.width(n.width()),r.height(n.height()),r.css({position:"absolute",left:0,top:0,opacity:0,cursor:"pointer"}),s.width(n.width()),s.height(n.height()),s.append(r),n.append(s),r.on("change",function(){i(s)})}),this},e.fn.scrollTo=function(e){return this.each(function(){"bottom"==e&&(this.scrollTop=this.scrollHeight)})},e.fn.setCursorPosition=function(t){if(e(this).focus(),t=t?t:e(this).val().length,e(this).get(0).setSelectionRange)e(this).get(0).setSelectionRange(t,t);else if(e(this).get(0).createTextRange){var i=e(this).get(0).createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select()}}}(jSH,document,{}),function(){"use strict";var e="0.8.0",t=1;if(!Object.create)var i=function(){};var n=Array.prototype.slice,s={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(e){s.eventHandlers[e.guid][e.type]||(s.eventHandlers[e.guid][e.type]=[]),s.eventHandlers[e.guid][e.type].push({guid:e.guid,handler:e.handler,scope:e.scope,type:e.type})},addEventHandler:function(e,t,i){var n,r={};"string"==typeof e?(n=i||!1,r[e]=t):(n=t||!1,r=e);for(var a in r)for(var o=r[a],l=a.split(" "),c=0,h=l.length;h>c;c++){var d=l[c];s.addEvent.call(this,{guid:this._guid||this._.guid,handler:o,scope:n,type:d})}},addGuid:function(e,i){(!e._guid||i)&&(e._guid=t++,s.attributes[e._guid]={},s.eventHandlers[e._guid]={})},attr:function(e){return s.attributes[e]},clone:function(e){var t=s.typeOf(e);return"object"===t?s.extend({},e):"array"===t?e.slice(0):void 0},create:function(e){return Object.create?Object.create(e):(i.prototype=e,new i)},createSubclass:function(e,t){function i(){if(!(this instanceof i))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&s.addGuid(this,!0),a.apply(this,arguments)}e=e||{},t=t||!1;var n=e.superclass.prototype,a=e.hasOwnProperty("constructor")?e.constructor:function(){};t&&s.extend(n,r),i.prototype=s.create(n),i.prototype.constructor=i,s.extend(i,{extend:function(){return s.extendThis.apply(this,arguments)},parent:n,proto:function(){return s.extendThis.apply(this.prototype,arguments)},subclass:function(e){return e=e||{},e.superclass=this,s.createSubclass(e)}});for(var o in e)"constructor"!==o&&"superclass"!==o&&(i.prototype[o]=e[o]);return i},emitEvents:function(e,t,i,r){i=i||!1,r=r||this._guid;for(var a=n.call(s.eventHandlers[r][e]),o=0,l=a.length;l>o;o++){var c=s.extend({},a[o]),h=c.scope?c.scope:this;i&&(c.type=i),c.scope=h,c.handler.call(c.scope,t,c)}},extend:function(){for(var e=n.call(arguments),t=e.shift(),i=0,s=e.length;s>i;i++){var r=e[i];for(var a in r)t[a]=r[a]}return t},extendThis:function(){var e=n.call(arguments);return e.unshift(this),s.extend.apply(this,e)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},removeAttribute:function(e,t){t=t||!1;for(var i=s.trim(e).split(" "),n=0,r=i.length;r>n;n++){var a=s.trim(i[n]);a&&(delete s.attr(this._guid)[a],t||(this.emit("change",a),this.emit("change:"+a),this.emit("remove",a),this.emit("remove:"+a)))}},removeEventHandler:function(e,t){var i=s.eventHandlers[this._guid];if(e&&t){if(i=i[e],!i)return;for(var n,r=0,a=i.length;a>r;r++)n=i[r].handler,n&&n===t&&(i.splice(r--,1),a--)}else e?delete i[e]:s.eventHandlers[this._guid]={}},setAttribute:function(e,t,i){i=i||!1;var n=this.has(e),r=s.attr(this._guid)[e];if(t!==r&&(s.attr(this._guid)[e]=t,!i)){this.emit("change",e),this.emit("change:"+e,t);var a={key:e,newValue:t,oldValue:r||null};this.emit("mutate",a),this.emit("mutate:"+e,a);var o=n?"update":"create";this.emit(o,e),this.emit(o+":"+e,t)}},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(e){return null===e||"undefined"==typeof e?String(e):Object.prototype.toString.call(e).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(e,t,i){var n=this.get(e),r=s.typeOf(n);("object"===r||"array"===r)&&(n=s.clone(n));var a=t.call(this,n,e);s.setAttribute.call(this,e,a,i||!1)}},r={emit:function(e,t){t="undefined"==typeof t?null:t;for(var i=e.split(" "),n=0,r=i.length;r>n;n++){var a=i[n];s.eventHandlers[-1].all&&s.emitEvents.call(this,"all",t,a,-1),s.eventHandlers[-1][a]&&s.emitEvents.call(this,a,t,a,-1),"number"==typeof this._guid&&(s.eventHandlers[this._guid].all&&s.emitEvents.call(this,"all",t,a),s.eventHandlers[this._guid][a]&&s.emitEvents.call(this,a,t))}},off:function(){s.removeEventHandler.apply(this,arguments)},on:function(){s.addEventHandler.apply(this,arguments)}};s.Module=function(){},s.Module.prototype={each:function(e,t){var i=s.attr(this._guid);for(var n in i){var r=i[n];e.call(t||this,r,n)}},extend:function(){return s.extendThis.apply(this,arguments)},filter:function(e){var t=[],i=s.attr(this._guid);for(var n in i)e.call(this,i[n],n)&&t.push(i[n]);return t},get:function(e){if("string"==typeof e)return this.has(e)?s.attr(this._guid)[e]:null;if("function"==typeof e){var t=this.filter(e);return t.length?t[0]:null}},getAll:function(){return s.clone(s.attr(this._guid))},getAllAsArray:function(){var e=[],t=s.attr(this._guid);for(var i in t){var n=t[i];"object"!==s.typeOf(n)||n.id||(n.id=i),e.push(n)}return e},has:function(e){return"undefined"!=typeof s.attr(this._guid)[e]},map:function(e,t){var i=[];return this.each(function(n,s){i.push(e.call(t||this,n,s))},t||this),i},push:function(e,t){if("array"===s.typeOf(e))for(var i=0,n=e.length;n>i;i++)s.setAttribute.call(this,s.makeUuid(),e[i],t||!1);else s.setAttribute.call(this,s.makeUuid(),e,t||!1);return this},remove:function(e,t){return"undefined"==typeof e?(s.attributes[this._guid]={},this.emit("change remove")):"function"==typeof e?this.each(function(i,n){e(i)&&s.removeAttribute.call(this,n,t)}):s.removeAttribute.call(this,e,t||!1),this},set:function(e,t,i){if("object"==typeof e)for(var n in e)s.setAttribute.call(this,n,e[n],t||!1);else s.setAttribute.call(this,e,t,i||!1);return this},size:function(){var e=0,t=s.attr(this._guid);for(var i in t)e++;return e},update:function(e,t,i){return"string"==typeof e?s.updateAttribute.call(this,e,t,i||!1):"function"==typeof e&&this.each(function(t,i){s.updateAttribute.call(this,i,e)}),this}};var a={_:s,extend:function(){return s.extendThis.apply(s.Module.prototype,arguments)},mixinEvents:function(e){return e=e||{},s.addGuid(e),s.extend(e,r)},on:function(){s.addEventHandler.apply(this,arguments)},subclass:function(e,t){return t=t||!1,e=e||{},e.superclass=t?function(){}:s.Module,s.createSubclass(e,!t)},version:e};window.SHClass=a}(),function(){"use strict";function e(){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},t=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(t,function(t){return e[t]||t}):this}}function t(e,i,n){return("string"==typeof i?i:i.toString()).replace(e.define||r,function(t,i,s,r){return 0===i.indexOf("def.")&&(i=i.substring(4)),i in n||(":"===s?(e.defineParams&&r.replace(e.defineParams,function(e,t,s){n[i]={arg:t,text:s}}),i in n||(n[i]=r)):new Function("def","def['"+i+"']="+r)(n)),""}).replace(e.use||r,function(i,s){e.useParams&&(s=s.replace(e.useParams,function(e,t,i,s){if(n[i]&&n[i].arg&&s){var r=(i+":"+s).replace(/'|\\/g,"_");return n.__exp=n.__exp||{},n.__exp[r]=n[i].text.replace(new RegExp("(^|[^\\w$])"+n[i].arg+"([^\\w$])","g"),"$1"+s+"$2"),t+"def.__exp['"+r+"']"}}));var r=new Function("def","return "+s)(n);return r?t(e,r,n):r})}function i(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var n={version:"1.0.0",templates:{},templateSettings:{include:/\{\{include ([\s\S]+?\}?)\}\}/g,locale:/\{\{t ([\s\S]+?\}?)\}\}/g,evaluate:/\{\{([\s\S]+?\}?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:void 0,compile:void 0};window.SHtmpl=n,String.prototype.encodeHTML=e();var s={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},r=/$^/;n.tmpl=function(e,t,i,s){var r=n.template(t,i,s);return n.templates[e]=r,r},n.template=function(a,o,l){o=o||n.templateSettings;var c,h,d=o.append?s.append:s.split,u=0,f=o.use||o.define?t(o,a,l||{}):a;f=("var out='"+(o.strip?f.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):f).replace(/'|\\/g,"\\$&").replace(o.include||r,function(e,t){return d.start+"SHtmpl.templates["+t+"](it)"+d.end}).replace(o.locale||r,function(e,t){return d.start+"SH._("+t+") || "+t+d.end}).replace(o.interpolate||r,function(e,t){return d.start+i(t)+d.end}).replace(o.encode||r,function(e,t){return c=!0,d.start+i(t)+d.endencode}).replace(o.conditional||r,function(e,t,n){return t?n?"';}else if("+i(n)+"){out+='":"';}else{out+='":n?"';if("+i(n)+"){out+='":"';}out+='"}).replace(o.iterate||r,function(e,t,n,s){return t?(u+=1,h=s||"i"+u,t=i(t),"';var arr"+u+"="+t+";if(arr"+u+"){var "+n+","+h+"=-1,l"+u+"=arr"+u+".length-1;while("+h+"<l"+u+"){"+n+"=arr"+u+"["+h+"+=1];out+='"):"';} } out+='"}).replace(o.evaluate||r,function(e,t){return"';"+i(t)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),c&&o.selfcontained&&(f="String.prototype.encodeHTML=("+e.toString()+"());"+f);try{return new Function(o.varname,f)}catch(p){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+f),p}},n.compile=function(e,t){return n.template(e,null,t)}}(),SHAudioFX=function(){var e="0.4.0",t=!1,i=document.createElement("audio"),n=function(e){var t=i.canPlayType(e);return"probably"===t||"maybe"===t};i&&i.canPlayType&&(t={ogg:n('audio/ogg; codecs="vorbis"'),mp3:n("audio/mpeg;"),wav:n('audio/wav; codecs="1"'),loop:"boolean"==typeof i.loop});var s=function(e,i,n){var s=document.createElement("audio");if(n&&"function"==typeof n){var r=function(){s.removeEventListener("canplay",r,!1),n()};s.addEventListener("canplay",r,!1)}return i.loop&&!t.loop&&s.addEventListener("ended",function(){s.currentTime=0,s.play()},!1),s.volume=i.volume||.1,s.autoplay=i.autoplay,s.loop=i.loop,s.src=e,s},r=function(e){for(var i=0;i<e.length;i++)if(t&&t[e[i]])return e[i]},a=function(e){var t,i;for(t=0;t<e.length;t++)if(i=e[t],i.paused||i.ended)return i},o=function(e,i,n){i=i||{};var o=i.formats||[],l=r(o),c=[];if(e+=l?"."+l:"",t)for(var h=0;h<(i.pool||1);h++)c.push(s(e,i,0==h?n:null));else n();return{audio:1==c.length?c[0]:c,play:function(){if(!SH.caches.get("off_sound")){var e=a(c);e&&e.play()}},stop:function(){var e,t;for(e=0;e<c.length;e++)t=c[e],t.pause(),t.currentTime=0}}};return o.version=e,o.supported=t,o}(),function(e,t){window.SH=function(i){var n=this;if(n.config=e.extend(SH.WS,i),SH.WS.widget_id=parseInt(SH.WS.widget_id),5==SH.WS.widget_id){var s=document.location.host;if(-1==s.indexOf("siteheart.com"))return}var r=SH.caches.get("referrer");r||SH.caches.set("referrer",document.referrer),"SH_GP_ONLINE"in window||(SH_GP_ONLINE=!0);var a={};if(n.on=function(e,t){"function"==typeof t&&(e in a||(a[e]=[]),-1==jSH.inArray(t,a[e])&&a[e].push(t))},n.off=function(e,t){if(e in a){for(var i=[],n=0;n<a[e].length;n++)a[e][n]!=t&&i.push(a[e][n]);a[e]=i}},n.call=function(){arguments=Array.prototype.slice.call(arguments);var e=arguments.shift();if(e in a){for(var t,i=0;i<a[e].length;i++)if(t=a[e][i].apply({},arguments),t===!1)return!1;return t}},n.clear=function(){SH.caches.remove("token"),SH.caches.remove("cliId"),SH.caches.remove("entId"),SH.caches.remove("me"),SH.caches.remove("messages"),SH.caches.remove("hypertext")},SH.caches.get("opened")?SH.caches.get("entId")&&(SH.WS.widget_id=SH.caches.get("entId")):n.clear(),SH.audio=new SHAudioFX(SH.DIR+"/audio/sound.message",{formats:["ogg","mp3","wav"],volume:.9,pool:1},function(){}),SH.root=this,"SH_POPUP"in window){"chatpopup"==SH._GET.sh_mode?(SH.WS.widget_id=parseInt(SH._GET.widget_id),SH.WS.href=t,SH._GET.href&&(SH.WS.href=decodeURIComponent(SH._GET.href)),SH._GET.auth&&(SH.WS.auth=decodeURIComponent(SH._GET.auth)),SH.app=new SH.ui.App(n.config),window.onfocus=SH.app.focus.bind(SH.app),window.onblur=SH.app.blur.bind(SH.app)):(SH.addEventListener(SH._GET.uid,function(e,t){var i=t.cache;
SH.caches.set(i),SH.app=new SH.ui.App(n.config),window.onfocus=SH.app.focus.bind(SH.app),window.onblur=SH.app.blur.bind(SH.app)},!0),window.opener.postMessage(JSON.stringify({cmd:"getCache",uid:SH._GET.uid}),SH.PROTOCOL+"//"+SH._GET.hostname)),setInterval(function(){jSH(document).trigger("windowresize")},100);var o=0,l=0,c=jSH(window);jSH(document).on("windowresize",function(){var e=c.height(),i=c.width(),n=navigator.userAgent.toLowerCase();try{if(n.match(/iPad/i)&&(n=n.indexOf("chrome")>-1?!1:!0)){var s=Math.abs(window.orientation);0==s?e=screen.height-95:90==s&&(e=screen.width-75)}}catch(r){}(e!=o||i!=l)&&SH.app.widget.resize(t,parseInt(i),parseInt(e))})}else SH.app=new SH.ui.App(n.config);var h=e('<iframe src="'+SH.DIR+"/html/a.html?s="+document.location.host+'" scrolling="no" frameborder="0" style="position:absolute;width:0;height:0;left:-14444;"></iframe>');setTimeout(function(){e("body").append(h)},1e3)}}(jSH,void 0),function(e){SH.VERSION="1",SH.LANGUAGE="ru",SH.PROTOCOL="https:"==document.location.protocol?"https:":"http:",SH.HOST="//www.siteheart.com",SH.CDN_HOST="//static.siteheart.com",SH.CDN_HOST_ORIGIN=SH.CDN_HOST,SH.API_HOST="//esapi.siteheart.com",SH.STREAM_HOST="client.siteheart.com",SH.DIR="/apps/widgetdev/",SH.SMILES=["smile","upset","no_words","laughter","shock","wink","sleep","steep","anger","offense"],SH.templates=[],SH.views={},SH.autoId=1,SH._GET={},SH.i18n={},SH.ui={},SH._=function(e,t){if(!(e in SH.i18n))return e;var i=SH.i18n[e];return t||(t={}),i.replace(/\{([\w\.]*)\}/g,function(e,i){var n=i.split(".");if(i=n.shift(),i in t)var s=t[i];else var s="";for(var r=0;r<n.length;r++)s=s[n[r]];return null===s||void 0===s?"":s})},SH._get=function(e){return e?SH.i18n[e]:SH.i18n},SH.isEmail=function(e){return/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/gi.test(e)?!0:!1},SH.popup=function(e,t,i,n,s){var r=(640-i)/2,a=(480-n)/2;screen&&(a=(screen.availHeight-n)/2,r=(screen.availWidth-i)/2);var o="menubar=0,location=0,toolbar=0,directories=0,scrollbars=0,status=0,resizable=1,width="+i+",height="+n+",screenX="+r+",screenY="+a+",top="+a+",left="+r,l=window.open(t,e,o);if(l.focus(),s)var c=setInterval(function(){(!l||l.closed)&&(clearInterval(c),s())},300);return l},SH.isMobile=function(){var e=navigator.userAgent;return e.match(/Android/i)||e.match(/webOS/i)||e.match(/iPhone/i)||e.match(/iPad/i)||e.match(/iPod/i)||e.match(/BlackBerry/i)||e.match(/Windows Phone/i)?!0:!1},SH.rm=function(t){var i;i=function(){t.remove(),e(document).off("click",i)},setTimeout(function(){e(document).on("click",i)},0)},SH.log=function(e,t){if(SH.DEBUG&&"console"in window&&"log"in console){"object"==typeof e&&(e=JSON.stringify(e));var i=new Date,n=i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+":"+i.getMilliseconds();t?"object"==typeof t&&(t=JSON.stringify(t)):t="",console.log("["+n+"] "+e+" "+t)}},SH.addCSS=function(e,t){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.media="screen",i.href=e;var n=!1,s=function(){n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(n=!0,t&&t(),i.onload=i.onreadystatechange=null)};i.onload=i.onreadystatechange=s;var r=setInterval(function(){n&&clearInterval(r);for(var e=document.styleSheets,t=e.length;t--;){var a=e[t];i.href===a.href&&(clearInterval(r),s())}},500);return SH.addFile(i),i},SH.addFile=function(e){var t=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0];t.appendChild(e)},SH.tmpl_parse=function(e){"object"==typeof e&&(e=e.data);var t,i=new RegExp('<t name="([0-9a-zA-Z_-]*)"[^>]*>(.*?)</t>',"gi");e=e.replace(/[\r\t\n]/g,"").replace(/\s{2,}/g," ").replace(/>\s</g,"><");try{for(;null!==(t=i.exec(e));)SHtmpl.tmpl(t[1],t[2])}catch(n){SH.log("ERROR parse template")}},SH.tmpl=function(e,t){return t=t||{},e in SHtmpl.templates?SHtmpl.templates[e](t):e},SH.$tmpl=function(t,i){return e(SH.tmpl(t,i))},SH.prepare=function(t,i){SH.DIR=SH.CDN_HOST+"/widget/sh/"+SH.VERSION;var n=["index","blue","green","orange","pink","red","dark","purple"],s=SH.WS.template||"index";i&&i.template&&(s=i.template),-1==e.inArray(s,n)&&(s="index");for(var r=SH.templates;r.length;)SH.tmpl_parse(r.shift());var a=SH.DIR+"/css/"+s+".css";SH.addCSS(a,function(){t()})},SH.ready=function(e){SHBeforeInitCallback=e},SH.appInit=function(){if(!(navigator.userAgent.indexOf("Opera Mini")>-1)){var t=[];"_shcp"in window&&(t=_shcp.slice(),_shcp=[]),SH.prepare(function(){e.isFunction(window.SHBeforeInitCallback)&&SHBeforeInitCallback();for(var i=0;i<t.length;i++){var n=t[i];SH.widget(n.widget,n)}},t[0])}},SH.widget=function(t,i){var n=new SH(i);e.isFunction(i.callback)&&i.callback(n,i)},SH.queryParams=function(t,i){for(var n={},s=t.substring("?"),s=s.replace("?",""),s=s.split("&"),r=0;r<s.length;r++){var a=s[r].split("=");i&&-1!=e.inArray(a[0],i)||(n[a[0]]=a[1])}return n},SH.setTest=function(){SH.TEST=!0,SH.STREAM_HOST="client.test.siteheart.com",SH.API_HOST="//web.test.siteheart.com"},SH.setDev=function(){SH.DEV=!0,SH.HOST="//web.test.siteheart.com",SH.CDN_HOST="",SH.DIR=SH.CDN_HOST+"/apps/widgetdev"},SH.addEventListener=function(e,t,i){var n;n=function(s){var r,a;try{r=decodeURIComponent(s.data),a=JSON.parse(r)}catch(o){try{r=unescape(s.data),a=JSON.parse(r)}catch(l){}}a&&e==a.uid&&(t(s,a),i&&(window.removeEventListener?window.removeEventListener("message",n):window.detachEvent("onmessage",n)))},window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent("onmessage",n)},SH.bytes=function(e){if(isNaN(e))return null;var t=[" bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"],i=Math.floor(Math.log(+e)/Math.log(2));1>i&&(i=0);var n=Math.floor(i/10);return e=+e/Math.pow(2,10*n),e.toString().length>e.toFixed(3).toString().length&&(e=e.toFixed(3)),e+t[n]},window.location.search&&(SH._GET=SH.queryParams(window.location.search)),(SH._GET.sh_test||"SH_TEST"in window)&&SH.setTest(),(SH._GET.sh_dev||"SH_DEV"in window)&&SH.setDev(),(SH._GET.sh_debug||"SH_DEBUG"in window)&&(SH.DEBUG=!0)}(jSH),function(){SH.WS={side:"right",position:"center",contact_comment:!0,contact_email:!0,contact_phone:!0,chat_to_email:!0,href:document.location.href,first_client_message:""};var e;SH.setWS=function(t){if(!e){e=!0,t.title||(t.title=SH.i18n.l1),t.title_offline||(t.title_offline=SH.i18n.l39);for(var i in t)SH.WS[i]=t[i];469884==SH.WS.widget_id&&(SH.WS.contact_comment=!1),4287==SH.WS.widget_id&&setInterval(function(){SH.WS.auth&&(SH.WS.contact_phone=!1)},2e3),3876==SH.WS.widget_id&&(SH.WS.white_label=!1,SH.WS.white_label_logo=!1)}}}(),function(e,t,i){var n=function(e){"init"in this&&this.init(e),"evn"in this&&this.evn(this)},s=function(e,t,i,n,s){n?t.on(i,n,function(t,i,n,r){return s.call(e,t,i,n,r)}):t.on(i,function(t,i,n,r){return s.call(e,t,i,n,r)})};e.View=function(e){var i=t.subclass({evn:function(e){var t=e.events;if(t)for(var i in t){var n=i.split(" "),r=t[i];"function"==typeof e[r]&&s(e,e.$el,n[0],n[1],e[r])}}});return e.constructor=n,i.subclass(e)},e.Model=function(e){return e.constructor=n,t.subclass(e)},e.Controller=function(e){return e.constructor=n,t.subclass(e)},e.Socket=function(s){var r=t.subclass({init:function(t){this.socket=new e.IO(t,this),this.socket.token=t.token},start:function(){this.isStarted||(this.socket.connect(),this.isStarted=!0,this.afterStart&&this.afterStart())},send:function(t,i){this.isStarted||this.start(),i.cmd=t,i.entId=e.WS.widget_id,this.socket.send(JSON.stringify(i))},close:function(){this.socket&&this.socket.close()},onmessage:function(t){var n=e.root.call(t.cmd,t);n!==!1&&(i.isPlainObject(n)&&(t=n),t.cmd in this&&this[t.cmd](t))},packets:function(e){var t=this;i(e.data).each(function(e,i){"string"==typeof i&&(i=JSON.parse(i)),t.onmessage(i)})}});return s.constructor=n,r.subclass(s)}}(SH,SHClass,jSH),function(e,t,i){t.IO=function(e,n){var s=this,r=null,a=0,o=!1,l=["websocket","jsonp"];s.settings=i.extend({path:"/streamcli/client",widget_id:"",auth:""},e),this.token=null,this.driver,t._GET.sh_socket?l=[t._GET.sh_socket]:"jsonp"==t.caches.get("socket")&&(l=["jsonp"]),this.offWebSocket=function(){t.caches.set("socket","jsonp")},this.connect=function(){if(t.app&&t.app.view&&t.app.view.get("a_ref")){var e=t.app.view.get("a_ref");e&&(t.log("[CONNECT] clearInterval answer_ref"),t.app.view.remove("a_ref"),clearInterval(e))}a=0,s.driver=1==l.length?l[0]:l.shift(),r=new s[s.driver](s);var i=r.connect(function(){a=1},f,u,s.token);i||s.connect()},this.send=function(e){1==a&&(t.log("[WRITE] ",e),r.send(e),h())},this.close=function(){a=4,r&&(r.close(),u())};var c,h=function(){c&&clearTimeout(c),c=setTimeout(function(){r&&r.ping(),h()},18e4)},d=function(){a=1,n.onopen&&n.onopen.call(n,{}),o=!0},u=function(){if(t.log("[CLOSED] onCloseSocket"),t.app&&t.app.view&&t.app.view.get("a_ref")){var e=t.app.view.get("a_ref");e&&(t.log("[CLOSED] clearInterval answer_ref"),t.app.view.remove("a_ref"),clearInterval(e))}4!=a&&(a=3,t.log("[CLOSED] socket "),n.onclose&&n.onclose.call(n,{}),r&&(r=null))},f=function(e){if("1"==e)return void t.log("[READ PONG] 1");if("0"==e)return t.log("[READ PING] 0"),void(r&&r.pong());if(t.log("[READ] ",e),"object"!=typeof e)try{e=JSON.parse(e)}catch(i){return}1!=a&&d(),n.onmessage&&n.onmessage.call(n,e),h()}},t.IO.prototype.getRequestUrl=function(e){var i=this.settings,n="";n="websocket"==e?("https:"==t.PROTOCOL?"wss://":"ws://")+t.STREAM_HOST:t.PROTOCOL+"//"+t.STREAM_HOST,n+=i.path+"?";for(var s in i)i[s]&&"path"!=s&&"token"!=s&&(n+="&"+s+"="+encodeURIComponent(i[s]));return this.token&&(n+="&token="+encodeURIComponent(this.token)),n+="&_="+(new Date).getTime(),t.log("[CONNECT] driver - "+e+", url - "+n),this.settings.restore_token=void 0,n},t.IO.prototype.websocket=function(i){var n,s,r="websocket";this.connect=function(t,a,o){if(!("WebSocket"in e||"MozWebSocket"in e))return!1;var l="WebSocket"in e?WebSocket:MozWebSocket;try{n=new l(i.getRequestUrl(r))}catch(c){return!1}return n.onopen=function(){s=1,t()},n.onmessage=function(e){a(e.data)},n.onclose=function(){o()},n.onerror=function(){s||i.offWebSocket()},!0},this.ping=function(){n.send("0"),t.log("[SEND PING] 0")},this.pong=function(){n.send("1"),t.log("[SEND PONG] 1")},this.send=function(e){n&&n.send(e)},this.close=function(){n&&n.close(),t.log("[CLOSED] WebSocket client")}},t.IO.prototype.jsonp=function(n){var s,r,a,o="jsonp",l=this,c=!1,h=!0;r=function(s,a,l){var d="Response_"+t.autoId++;e[d]=function(e){h&&s(),h=!1,a(e)};try{var u=n.getRequestUrl(o)+"&response_type=callback&callback="+d;t.getScript(u,function(t,o){t?(e[d]=null,c||setTimeout(function(){r(s,a,l,n.token)},50)):(c=!0,l()),setTimeout(function(){i(o).remove()},1e3)})}catch(f){c=!0,l()}},this.connect=function(e,t,i,n){return a=t,r(e,t,i,n),!0},this.send=function(e){t.IOApi("/streamcli/push",{data:e,token:n.token})},this.ping=function(){c||l.send("0"),t.log("[SEND PING] 0")},this.pong=function(){c||l.send("1"),t.log("[SEND PONG] 1")},this.close=function(){c=!0,s&&s.abort(),s=null,t.log("[CLOSED] JSONP client")}},t.IOApi=function(e,n,s,r){r=r||{};var a,o="shi_"+t.autoId++;a=-1!=e.indexOf("api()")?t.API_HOST:-1!=e.indexOf("host()")?t.HOST:"//"+t.STREAM_HOST,a+=e.replace("api()","").replace("host()","")+"?_="+(new Date).getTime(),a+="&callback=postmessage2",a+="&uid="+o,a+="&host="+encodeURIComponent(t.PROTOCOL+"//"+document.location.host);var l=jSH('<form id="sh_form_'+o+'"></form>').attr("target",o).attr("action",a).attr("method","POST").attr("accept-charset","utf-8").hide();r.multipart&&l.attr("enctype","multipart/form-data"),r.file&&l.append(r.file);var c=jSH("<iframe></iframe>").attr("id",o).attr("name",o).hide();if(i.isPlainObject(n))for(var h in n)l.append(i("<textarea></textarea>").attr("name",h).val(n[h]));else l.append(i("<textarea></textarea>").attr("name","data").val(n));var d=!1;t.addEventListener(o,function(e,t){d=!0,s&&s(t),l.remove(),c.remove()},!0),i("body").append(l).append(c),c.get(0).onload=function(){setTimeout(function(){l.remove(),c.remove()},800)},l.get(0).submit()},t.getScript=function(e,t){var n=i("head")[0]||document.documentElement,s=document.createElement("script");s.src=e,s.async=!0,s.type="text/javascript",s.setAttribute("charset","UTF-8"),s.onerror=function(){t&&t(!1,s)};var r=!1;return s.onload=s.onreadystatechange=function(){r||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(r=!0,t&&t(!0,s),s.onload=s.onerror=s.onreadystatechange=null,n&&s.parentNode)},n.insertBefore(s,n.firstChild),{abort:function(){i(s).remove()}}}}(this,SH,jSH),function(e,t){e.SocketReader=e.Socket({onclose:function(){var t=this.get("reconnect_count");if(t||(t=1),t>5)return void e.caches.remove();this.set("reconnect_count",t++);var i=this;setTimeout(function(){e.app.view.reconnect();var t=e.app.get_online_data();i.init(t),i.isStarted=!1,i.start()},2e3)},token:function(t){e.app.socket.socket.token=t.token;var i={acc_id:t.acc_id||0,nick:t.nick||e.i18n.l35};e.caches.set("me",i),e.caches.set("token",t.token),this.get("started")||(this.set("started",1),e.app.writer.guestOnline())},restored:function(t){var i={acc_id:t.acc_id||0,nick:t.nick||e.i18n.l35};e.caches.set("me",i),e.app.view.restore(t)},not_restored:function(){e.caches.remove(),e.app.socket.close(),e.app.widget.$el.hide()},clientChangeEnterprise:function(t){e.WS.widget_id=t.newEntId,e.caches.set("entId",e.WS.widget_id)},clientOutsourcing:function(t){e.WS.outsourceId=e.WS.widget_id,e.WS.widget_id=t.outsourcingId,e.caches.set("entId",e.WS.widget_id),e.app.socket.close();var t=e.app.get_online_data();t.token=void 0,t.restore_token=void 0,this.remove(),this.init(t),this.isStarted=!1,this.start()},enterpriseOnline:function(t){if(t.accId){var i={acc_id:t.accId,nick:t.nick};e.caches.set("me",i)}e.caches.set("cliId",t.cliId),e.app.view.wait_operator(t),e.app.view.send_first_message(),t.hypertext&&e.caches.set("hypertext",t.hypertext)},clientRoomSellerAcceptedDef:function(e){this.clientRoomSellerAccepted(e)},clientRoomSellerAccepted:function(t){e.app.view.$el.find("[rel=wait]").remove(),t.acc_id=t.selId,e.app.view.add_message(t),e.audio.play()},clientRoomSellerClosed:function(){e.app.widget.chat_complate(void 0,!0),e.caches.set("opened",!1),e.app.socket.close()},clientMessage:function(t){t.acc_id=t.selId,e.app.view.add_message(t),e.caches.inc("countmsg"),e.audio.play()},chatAutoMessage:function(t){t.isHTML=!0,t.text=(t.text||"").fromBBCode(),this.clientMessage(t),e.caches.inc("countmsg")},clientNewBill:function(t){e.app.view.add_bill(t),e.audio.play(),e.caches.inc("countmsg")},Form:function(t){e.app.view.add_form(t),e.audio.play(),e.caches.inc("countmsg")},basyForm:function(i){i.form||(i.form={steps:[{description:e.i18n.l14+" "+e.i18n.l15,fields:[{tag:"input",type:"text",title:e.i18n.l58,api_key:"name"},{tag:"input",type:"text",title:"E-mail",api_key:"email"},{tag:"input",type:"text",title:e.i18n.l47,api_key:"phone"},{tag:"textarea",title:e.i18n.l59,api_key:"text"}]}]}),i.form.type="basy",e.app.view.add_form(i.form),e.audio.play(),t("#sh_container").find("[rel=footer]").hide(),e.app.widget.resize(),e.app.socket.close(),e.caches.set("opened",0)},clientSetFormFields:function(t){e.app.view.form_fields(t)},clientFormResult:function(t){e.app.view.form_result(t)},chatStartForm:function(t){t.outsourcingId&&(e.WS.outsourceId=e.WS.widget_id,e.WS.widget_id=t.outsourcingId,e.caches.set("entId",e.WS.widget_id)),e.root.clear(),e.app.socket.close(),t.form.type="start",e.app.view.add_form(t.form),e.audio.play()},clientPostEdit:function(e){t("#sh_"+e.id).html((e.text||"").toMessage())},enterpriseOffline:function(){window.SH_GP_ONLINE=!1,e.app.socket.close(),e.caches.remove(),e.app.widget.$el.remove(),e.app.remove("chat"),e.app.show_chat()},sellerRoomInvite:function(t){t.text&&(t.acc_id=t.selId,e.app.view.add_message(t))},clientTyping:function(t){e.app.view.seller_typing(t)},clientBillDone:function(t){e.app.view.bill_done(t),e.audio.play()},clientRoomHistory:function(i){var n=e.caches.get("me");t(i.data.reverse()).map(function(){this.acc_id=this.selId||n.acc_id,"room_message_auto"==this.event_kind&&(this.isHTML=!0,this.text=(this.text||"").fromBBCode()),e.app.view.add_history(this)})}})}(SH,jSH),function(e){e.SocketWriter=e.Controller({guestOnline:function(){e.app.socket.send("guestOnline",{entId:e.WS.widget_id,auth:e.WS.auth,browser:navigator.userAgent,reffer:e.WS.href,language:e.language,outsourceId:e.WS.outsourceId,form:e.WS.form_text})},clientPost:function(t,i){var n=e.caches.get("me");if(!n){e.app.socket.start();var s=this;return void setTimeout(function(){s.clientPost(t,i)},100)}var r=e.WS.widget_id,a=e.caches.get("cliId"),o=r+"_"+a+"_"+(new Date).getTime(),l={entId:r,text:t,id:o,files:i};e.app.socket.send("clientPost",l),l.acc_id=n.acc_id,l.nick=n.nick,e.app.view.add_message(l),e.caches.inc("countmsg")},clientRoomClose:function(){e.app.socket.send("clientRoomClose",{entId:e.WS.widget_id})},clientGetFormFields:function(t,i){e.app.socket.send("clientGetFormFields",{formId:t,step:i})},clientSendBill:function(t,i){e.app.socket.send("clientSendBill",{billId:i,email:t});var n=e.WS.widget_id,s=e.caches.get("token"),r=e.caches.get("cliId"),a={entId:n,token:s,cliId:r,billId:i,email:t};e.IOApi("api()/esapi/chat/sendbill",a)},clientAnswerTimeout:function(t,i){e.app.socket.send("clientAnswerTimeout",{status:t,time:i})},clientPrevHistory:function(t){e.app.socket.send("clientPrevHistory",{offset:t})},clientAutoMessageVote:function(t,i){e.app.socket.send("clientAutoMessageVote",{id:t,vote:i,user_agent:navigator.userAgent})}})}(SH,jSH),function(e){var t=function(e){var t={},i="shdata",n=window[""+e+"Storage"];try{n.setItem("f",1),n.removeItem("f");var s=n.getItem(i)||{};try{s&&(t=JSON.parse(s)),t||(t={})}catch(r){n.removeItem(i),t={}}}catch(r){console.error(r)}this.get=function(e){return t?e?t[e]:t:void 0},this.set=function(e,i){if(t&&e){if("string"==typeof e)t[e]=i;else for(var n in e)t[n]=e[n];this.save()}},this.inc=function(e){t&&(e in t||(t[e]=0),t[e]++,this.save())},this.remove=function(e){t&&(e?t[e]=void 0:t={},this.save())},this.save=function(){try{n.setItem(i,JSON.stringify(t))}catch(e){}}};e.caches=new t("session"),e.cachel=new t("local")}(SH),function(e,t){e.ui.App=e.Controller({init:function(t){e.app=this,this.set("config",t),this.set("document.title",document.title);var i=e.caches.get("opened")||window.SH_POPUP;i||e.WS.autostart?this.show_chat():this.show_button()},blur:function(){e.root.on("clientMessage",this.blur_msg)},blur_msg:function(){var t=e.app.get("document.title"),i=e.app.get("title_interval");if(!i){var n=setInterval(function(){document.title=document.title==t?"**********************":t},500);e.app.set("title_interval",n)}},focus:function(){var t=e.app.get("title_interval");t&&(clearInterval(t),e.app.remove("title_interval"),document.title=e.app.get("document.title")),e.root.off("clientMessage",e.app.blur_msg)},show_button:function(){if(this.indicator)this.indicator.view.$el.show();else{var t=new e.ui.Indicator(this.get("config"));this.indicator=t}e.root.call("eventJSButtonShow",{})},show_chat:function(){if(e.root.call("eventJSWidgetBeforeShow",{}),this.get("chat"))e.app.widget.$el.show();else{var t=new e.ui.Chat;this.set("chat",t)}e.root.call("eventJSWidgetShow",{})},exit:function(t){"SH_POPUP"in window?window.close():(e.app.widget.$el.remove(),t||e.app.show_button()),e.app.socket&&e.app.socket.close(),e.caches.remove(),this.remove(),e.root.call("eventJSWidgetExit",{}),e.WS.init_widget_id&&(e.WS.widget_id=e.WS.init_widget_id)},create_form:function(t){t.step=0;var i=e.$tmpl("sh_form",t);return i.data(t),this.set_form_step(i,0),1==t.steps.length&&i.find("[rel=step] span").hide(),i},set_form_step:function(t,i){var n=t.data(),s=n.steps[i],r=s.api_fields;if(r)return void e.app.writer.clientGetFormFields(s.form_id,s.step);t.find("[rel=fields]").empty();for(var a=0;a<s.fields.length;a++){var o=s.fields[a];if("select"==o.tag||"radio"==o.type||"checkbox"==o.type){jSH.isArray(o.value)||(o.value=JSON.parse(o.value)),o.values=[];for(var l=0;l<o.value.length;l++){var c=o.value[l].split("=");o.values.push({title:c[0],value:c[1]||c[0]})}}var h=e.$tmpl("sh_form_"+o.tag,o);h.data(o),t.find("[rel=fields]").append(h)}s.button_name&&t.find("[rel=form_button]").text(s.button_name),t.find("input[placeholder], textarea[placeholder]").placeholder(),t.find("[rel=step]").removeClass("sh_form_step_act").eq(i).addClass("sh_form_step_act"),t.find("[rel=description]").text(s.description||""),1==s.hide_textarea&&e.app.widget&&(e.app.widget.$el.find("[rel=footer]").hide(),e.app.widget.resize())},get_form_data:function(i){var n=i.data();if(n&&"step"in n){for(var s=n.step,r=i.find("[rel=field]"),a="",o={},l={},c=[],h=0;h<r.length;h++){var d=t(r.get(h)),u=d.data(),f="";if("input"!=u.tag||"radio"!=u.type&&"checkbox"!=u.type?f=d.find(u.tag).val():(f=[],d.find("input:checked").each(function(){f.push(t(this).val())})),d.find(u.tag).attr("placeholder")==f&&(f=""),!f.length&&u.required)return void alert(e.i18n.l12);var p=t.isArray(f)?f.join(", "):f;c.push({id:u.field_id,value:p,title:u.title,api_key:u.api_key,tag:u.tag,type:u.type});var v=t.isArray(f)?f.join(", "):f;o["field"+(h+1)]=v.toMessage(),a+=u.title+": "+v+"\n",l[u.title]=v}var _=n.steps[s],m=n.formId,g=s+1;return _&&_.form_id&&(m=_.form_id,g=_.step),{formId:m,formDataId:n.formDataId,step:g,fields:c,text:a,result:o}}},get_online_data:function(){var t=e.caches.get("token"),i=e.caches.get("cliId");return{widget_id:e.WS.widget_id,auth:e.WS.auth,browser:navigator.userAgent,reffer:e.WS.href,cli_id:i,language:e.language,type:"client",token:t,restore_token:t}}})}(SH,jSH),function(e,t){function i(t,i){for(var n=t.split(""),s="",r=0;r<n.length;r++)s+=e.tmpl(i,{"char":n[r]});return s}var n=e.View({events:{click:"click","click [rel=invite_yes]":"invite_yes","click [rel=invite_no]":"invite_no","click [rel=invite_close]":"invite_close"},init:function(){var n=this,s=e.WS.side,r=e.WS.position,a=window.SH_GP_ONLINE;if(this.$el=e.$tmpl("sh_btn",e.WS),"left"==s||"right"==s){if("trans"==e.WS.text_layout)var o="sh_btn_char_trans";else var o="sh_btn_char";var l=i(this.$el.find("[rel=title]").html(),o);this.$el.find("[rel=title]").html(l)}if(a||!e.WS.hide_offline){if(t("body").append(this.$el),a&&e.WS.hide&&this.$el.hide(),e.WS.white_label_logo){var c=e.WS.white_label_logo.replace("siteheartcdn",e.CDN_HOST_ORIGIN);this.$el.find("[rel=logo]").attr("src",c)}else{var h=this.$el.find("[rel=logo]").attr("src");setInterval(function(){this.$el.find("[rel=logo]").attr("src",h)}.bind(this),2e3)}"center"==r&&(n.$el.css({visibility:"hidden"}),setTimeout(function(){if("left"==s||"right"==s){var e=n.$el.height();n.$el.css({top:(t(window).height()-e)/2,visibility:"visible"})}else{var i=n.$el.width();n.$el.css({left:(t(window).width()-i)/2,visibility:"visible"})}},10)),a&&(e.WS.invite_timeout&&(this.INVITE_TIMEOUT=setTimeout(function(){n.invite_guest()},e.WS.invite_timeout)),this.init_quests())}},init_quests:function(){if(e.WS.track){this.$el.addClass("sh_monitor");var t=e.caches.get("guest_token"),i={widget_id:e.WS.widget_id,auth:e.WS.auth,browser:navigator.userAgent,type:"guest",token:t,restore_token:t};e.app.guests=new e.ui.Guests(i),e.app.guests.button=this,e.app.guests.start()}},invite_guest:function(t){var i=this.invited||e.caches.get("invite_no");if(!i){this.invited=!0;var n=e.WS.invite_nick||e.WS.robot_nick;t||(t={text:e.WS.invite_text,selId:e.WS.robot_id,nick:n&&"Robot"!=n?n:document.location.hostname},e.WS.invite_image&&(t.avatar=e.WS.invite_image),e.root.call("inviteGuest",t)),t.avatar||(t.avatar=t.selId?e.API_HOST+"/esapi/picture/"+t.selId:e.DIR+"/img/operator_logo.png"),this.$el.show(),this.$el.find("[rel=invite]").remove(),this.$el.append(e.$tmpl("sh_btn_invite",t))}},invite_yes:function(){this.$el.find("[rel=invite]").remove(),this.$el.click()},invite_no:function(){this.$el.find("[rel=invite]").remove(),e.caches.set("invite_no",1)},invite_close:function(){this.$el.find("[rel=invite]").remove()},click:function(i){t(i.target).closest("[rel=invite]").size()||(this.$el.hide(),e.isMobile()?new e.ui.Chat({popup:!0}):e.app.show_chat(),this.INVITE_TIMEOUT&&clearTimeout(this.INVITE_TIMEOUT))},update_counter:function(t){e.WS.track_widget&&this.$el.find("[rel=counter]").text(t.count).parent().show()}}),s=e.View({}),r=e.View({events:{click:"click"},init:function(){this.$el=t(e.WS.btn_selector)},click:function(){e.app.show_chat()}});e.ui.Indicator=e.Controller({init:function(){var t=e.WS.type;this.view="button"==t?new s:"link"==t?new r:new n}})}(SH,jSH),function(e){e.ui.Guests=e.Socket({setGuestOnSite:function(){if(!this.get("started")){this.set("started",1);var t=e.caches.get("referrer"),i={title:document.title,browser:navigator.userAgent,language:e.language,href:e.WS.href,referrer:t};this.send("guestOnSite",i)}},token:function(t){e.caches.set("guest_token",t.token),this.socket.token=t.token,this.setGuestOnSite()},restored:function(){this.setGuestOnSite()},not_restored:function(){e.caches.remove(),this.close()},inviteGuest:function(e){this.button.invite_guest(e)},onlineGuests:function(e){this.button.update_counter(e)}})}(SH,jSH),function(e,t){var i=e.View({events:{"click [rel=hide]":"hide","click [rel=close]":"chat_exit","click [rel=popup]":"popup",dragresize:"resize",dragdrop:"dragdrop","click [rel=complate]":"chat_complate","click [rel=new_chat_btn]":"new_chat_btn","click [rel=complate_back]":"chat_complate_back","click [rel=complate_save]":"chat_complate_save","click [rel=vote]":"chat_vote"},init:function(){if(this.$el=e.$tmpl("sh_chat",e.WS),e.WS.white_label&&this.$el.find("[rel=copyright] a").hide(),e.WS.white_label_logo){var i=e.WS.white_label_logo.replace("siteheartcdn",e.CDN_HOST_ORIGIN);this.$el.find("[rel=logo]").attr("src",i)}else{var n=this.$el.find("[rel=logo]").attr("src");setInterval(function(){this.$el.find("[rel=logo]").attr("src",n)}.bind(this),2e3)}var s=window.SH_GP_ONLINE,r=e.caches.get("opened");s&&e.WS.divisions&&!r?this.init_divisions():s&&e.WS.form_start&&!r?this.init_start_form():s?this.init_online():this.init_offline();var a=this;t(window).on("resize",function(){a.set_position()})},init_online:function(){this.$el.find("#sh_container_root").removeClass("sh_scrollbar").removeAttr("rel"),this.$el.find("#sh_container").removeClass("sh_container"),new e.ui.Online(e.app.get("config")),this.after_init()},init_offline:function(){new e.ui.Offline,this.after_init()},init_history:function(){e.app.view={},e.app.view.$el=e.$tmpl("sh_history",{}),this.after_init()},init_divisions:function(){new e.ui.Divisions,this.after_init()},init_start_form:function(t){new e.ui.Form(t),this.after_init()},after_init:function(){var i=e.app.view.$el;this.$el.find("#sh_container").html(i);var n=e.WS.w_type;if("embed"==n||"popup"==n){this.$el.addClass("sh_"+n);var s=t(e.WS.w_selector);s.height()>200&&this.$el.height(s.height()),s.html(this.$el)}else{this.$el.drag("[rel=title]").resize("[rel=resize]",{mw:300,mh:300}),t("body").append(this.$el);var r=this;r.set_position(),t(function(){r.set_position()})}this.resize()},set_position:function(){var t=jSH(window).height()-this.$el.height()-20,i=e.caches;if(0>t&&(t=0),"left"==e.WS.side||"left"==e.WS.position)this.$el.css({top:t,left:20});else{var n=jSH(window).width()-this.$el.width()-20;0>n&&(n=0),this.$el.css({top:t,left:n})}i.get("top")&&this.$el.css({top:i.get("top"),left:i.get("left")}),i.get("height")&&this.$el.css({height:i.get("height"),width:i.get("width")})},resize:function(t,i,n){i&&this.$el.width(i),n&&this.$el.height(n);var i=this.$el.width(),n=this.$el.height(),s=this.$el.find("[rel=header]").height()||0,r=this.$el.find("[rel=copyright]").height()||0,a=this.$el.find("[rel=footer]").height()||0;this.$el.find("[rel=scrollbar]").css("height",n-s-r-a-7),e.caches.set("height",n-2),e.caches.set("width",i-2),e.root.call("eventJSChatResize",{})},dragdrop:function(t,i,n){e.caches.set("top",i),e.caches.set("left",n)},hide:function(){e.app.show_button(),this.$el.hide()},popup:function(){if(e.caches.get("opened")){var t="shi_"+e.autoId++,i=e.DIR+"/html/popup.html?";i+="widget_id="+e.WS.widget_id,e.WS.auth&&(i+="&auth="+encodeURIComponent(e.WS.auth)),i+="&sh_lang="+e.language,i+="&hostname="+document.location.hostname,i+="&uid="+t,e.DEV&&(i+="&sh_dev=1"),e.TEST&&(i+="&sh_test=1");var n=e.caches.get(),s=e.popup("shchat",i,450,470,function(){e.app.show_button(),e.root.call("eventJSWidgetExit",{})});e.addEventListener(t,function(e,i){"getCache"==i.cmd&&s.postMessage(JSON.stringify({cmd:"setCache",uid:t,cache:n}),e.origin)},!0),e.app.exit(!0),e.root.call("eventJSPopupShow",{})}},chat_exit:function(t){e.caches.get("opened")?this.chat_complate(t):e.app.exit()},chat_complate:function(t,i){if(!e.caches.get("opened"))return void e.app.exit();var n=this.$el.find("#sh_container");return n.find("[rel=complate_save]").size()?void n.find("[rel=complate_save]").click():(this.$el.find("#sh_container_root").addClass("sh_scrollbar").attr("rel","scrollbar"),n.addClass("sh_container"),n.find("[rel=online]").hide(),n.find("[rel=footer]").hide(),n.append(e.$tmpl("sh_online_complate")),n.find("input[placeholder], textarea[placeholder]").placeholder(),i&&n.find("textarea").attr("disabled","disabled"),void this.resize())},chat_complate_back:function(){var t=this.$el.find("#sh_container");this.$el.find("#sh_container_root").removeClass("sh_scrollbar").removeAttr("rel"),t.removeClass("sh_container"),t.find("[rel=online]").show(),t.find("[rel=footer]").show(),t.find("[rel=online_complate]").remove(),e.caches.get("opened")||t.find("[rel=answer_form]").html(e.$tmpl("new_chat_btn",{})),this.resize()},new_chat_btn:function(){"SH_POPUP"in window?location.reload():(e.app.exit(),t("#sh_button").click())},chat_vote:function(e){t(".e_sh_chat_voted").removeClass("e_sh_chat_voted"),t(e.target).addClass("e_sh_chat_voted").parent().find("input").click();var i=t(e.target).data("vote");"no"==i?this.$el.find("[rel=vote_contacts]").show():this.$el.find("[rel=vote_contacts]").hide()},chat_complate_save:function(){var i=e.WS.widget_id,n=e.caches.get("token"),s=e.caches.get("cliId");e.app.writer.clientRoomClose(),e.app.socket.close();var r={entId:i,cliId:s,token:n,timeoffset:-(new Date).getTimezoneOffset()||120},a=t(".e_sh_chat_voted").data("vote")||void 0,o=this.$el.find("[rel=exit_email]").val()||void 0;if(o&&!e.isEmail(o))return void alert(e.i18n.l10);if(o&&(r.email=o),a&&(r.vote=a),"no"==a){if(r.phone=this.$el.find("[rel=exit_contact_phone]").val()||void 0,r.comment=this.$el.find("[rel=exit_contact_comment]").val()||void 0,r.email2=this.$el.find("[rel=exit_contact_email]").val()||void 0,r.email2&&!e.isEmail(r.email2))return void alert(e.i18n.l10);if(e.WS.contact_phone&&e.WS.contact_email&&!r.email2&&!r.phone)return void alert(e.i18n.l10)}e.IOApi("api()/esapi/chat/complete/",r,function(){e.app.exit()})}}),n=e.View({init:function(){var t="shi_"+e.autoId++,i=e.DIR+"/html/popup.html?";i+="widget_id="+e.WS.widget_id,e.WS.auth&&(i+="&auth="+encodeURIComponent(e.WS.auth)),i+="&sh_lang="+e.language,i+="&hostname="+document.location.hostname,i+="&uid="+t,i+="&sh_mode=chatpopup",e.DEV&&(i+="&sh_dev=1"),e.TEST&&(i+="&sh_test=1"),e.popup("shchat",i,450,470,function(){e.app.show_button(),e.root.call("eventJSWidgetExit",{})}),e.root.call("eventJSPopupShow",{})}});e.ui.Chat=e.Controller({init:function(t){t=t||{};var s=e.WS.type;return t.popup?void new n:void(e.app.widget="popup"==s?new n:new i)}})}(SH,jSH),function(e){var t=e.View({events:{"click [rel=form_button]":"send_fom"},init:function(){this.$el=e.$tmpl("sh_offline_box");var t=e.WS.form_offline;t?this.custom_form(t):this.default_form()},default_form:function(){this.set("form_type","default"),this.set("form_id",null);var t={steps:[{description:e.i18n.l14+" "+e.i18n.l15,fields:[{tag:"input",type:"text",title:e.i18n.l58,api_key:"name"},{tag:"input",type:"text",title:"E-mail",api_key:"email"},{tag:"input",type:"text",title:e.i18n.l47,api_key:"phone"},{tag:"textarea",title:e.i18n.l59,api_key:"text"}]}]},i=e.app.create_form(t);this.$el.append(i)},custom_form:function(t){this.set("form_type","custom"),this.set("form_id",t);var i=this;e.IOApi("api()/esapi/chat/getform/",{entId:e.WS.widget_id,formId:t},function(n){if(n.id){n.formId=t;
var s=e.app.create_form(n);i.$el.append(s)}else i.default_form()})},send_fom:function(t){var i="disabled",n=jSH(t.target).attr(i);if(n!=i){var s=jSH(t.target).closest("[rel=form]"),r=e.app.get_form_data(s);if(r){for(var a,o,l,c,h=[],d=this.get("form_type"),u=0;u<r.fields.length;u++){var f=r.fields[u],p=f.value;"text"==f.api_key&&(a=p),"email"==f.api_key&&(o=p),"name"==f.api_key&&(l=p),"phone"==f.api_key&&(c=p),h.push(f.title),h.push(p)}var v={entId:e.WS.widget_id,page_url:document.location.href,page_title:document.title,language:e.language};if("default"==d){if(!e.isEmail(o))return void alert(e.i18n.l10);if(""==a)return void alert(e.i18n.l11);v.email=o,v.phone=c,v.text=a,v.name=l}else v.form_id=this.get("form_id"),v.data=JSON.stringify(r.fields),v.fields=JSON.stringify(h);s.find("[rel=form_button]").attr(i,i);var _=this;e.IOApi("api()/esapi/offline/message",v,function(){_.$el.html(e.$tmpl("sh_offline_done"))})}}}});e.ui.Offline=e.Controller({init:function(){e.app.view=new t}})}(SH,jSH),function(e,t){var i=e.Model({}),n=e.View({events:{"click [rel=hide]":"hide","click [rel=smiles]":"smiles","click [rel=smile]":"smile","click [rel=sound]":"sound","click [rel=enter]":"send_message","keyup textarea":"send_message","keydown textarea":"send_post_typing","uploaded [rel=attach]":"attach","click [rel=form_button]":"send_fom","click [rel=bill_email]":"render_bill_email","click [rel=bill_email_send]":"send_bill_email","click [rel=history]":"get_history","click [rel=hypertext]":"show_hypertext"},init:function(t){this.model=t,this.$el=e.$tmpl("sh_online_box",t.getAll()),this.messages=this.$el.find("#sh_messages"),this.textarea=this.$el.find("textarea"),e.caches.get("off_sound")&&this.sound();var i=this;setTimeout(function(){i.$el.find("[rel=attach]").attach()},10),e.root.on("eventJSChatResize",function(){i.set_textarea_width()}),this.start_socket()},start_socket:function(){var t=this.get("a_ref");t&&(this.remove("a_ref"),clearInterval(t));var i=this,n=e.app.get_online_data();e.app.writer=new e.SocketWriter(this.model),e.app.socket=new e.SocketReader(n);var s=e.caches.get("opened"),r=e.caches.get("countmsg");if(e.app.socket.afterStart=function(){s&&i.restore(),e.caches.set("opened",!0)},!e.WS.autostart||s&&r)e.app.socket.start();else{var a={cmd:"clientRoomSellerAcceptedDef",entId:e.WS.widget_id,selId:e.WS.robot_id||23281121,nick:e.WS.robot_nick||document.location.host,text:e.i18n.l40,time:parseInt((new Date).getTime()/1e3)};e.caches.remove("messages"),setTimeout(function(){e.app.socket.onmessage(a)},10)}},hide:function(){this.$el.hide()},smiles:function(i){var n=e.$tmpl("sh_smiles_box");t(i.target).parent().append(n),e.rm(n)},smile:function(e){var i=t(e.target).attr("data-name"),n=this.textarea.val();this.textarea.val(n+"(:"+i+":)").setCursorPosition()},attach:function(t,i){i.result&&"error"==i.result||(i=JSON.stringify([{size:i.size,type:i.type,name:i.name,href:"//"+i.href}]),e.app.writer.clientPost(null,i))},sound:function(){var t,i=this.$el.find("[rel=sound]");i.hasClass("sh_ic_off")?(i.removeClass("sh_ic_off"),t=!1):(i.addClass("sh_ic_off"),t=!0),e.caches.set("off_sound",t)},scroll_end:function(t){var i=this.messages;i.get(0).scrollTop=1e7,e.caches.set("messages",i.html()),this.set("last_acc_id",t)},answer_timeout:function(t){var i=this.get("a_ref");if(t){if(i)return;var n,s=parseInt((new Date).getTime()/1e3);n=setInterval(function(){var i=parseInt((new Date).getTime()/1e3)-s;e.app.writer.clientAnswerTimeout(t,i)},6e4),this.set("a_ref",n)}else i&&(this.remove("a_ref"),clearInterval(i),e.app.writer.clientAnswerTimeout(t,0))},reconnect:function(){this.answer_timeout(!1),this.set("reconnect",1),this.messages.find("[rel=wait]").remove(),this.messages.append(e.$tmpl("sh_wait_connection",{text:e.i18n.l38}))},not_restore:function(){this.answer_timeout(!1)},restore:function(t){if(this.answer_timeout(!1),this.get("reconnect"))return this.messages.find("[rel=wait]").remove(),void this.remove("reconnect");if(!t){var i=e.caches.get("messages");i&&this.messages.html(i);var n=this;setTimeout(function(){n.scroll_end()},10)}},wait_operator:function(t){var i=this.messages;e.WS.autostart||i.html(e.$tmpl("sh_wait_connection",{text:e.i18n.l28})),t.history&&i.prepend(e.$tmpl("sh_history_btn"))},send_message:function(i){var n=t.trim(this.textarea.val());return""==n?!0:(this.send_typing(i,!0),"click"!=i.type&&i&&(13!=i.keyCode||i.ctrlKey)?!0:(this.textarea.val(""),e.app.writer.clientPost(n,null),void this.send_typing(i,!1)))},send_typing:function(t,i){if(t&&t.keyCode){var n=this.get("typing");if(n&&clearTimeout(n),i){n||e.app.socket.send("clientTyping",{status:i});var s=this;n=setTimeout(function(){s.send_typing({keyCode:1},!1)},1e4),this.set("typing",n)}else e.app.socket.send("clientTyping",{status:i}),this.remove("typing")}},send_post_typing:function(i){if(i&&i.keyCode&&(!i.ctrlKey||67!=i.keyCode)&&"websocket"==e.app.socket.socket.driver){var n=[13,16,17,18,33,34,35,36,36,37,38,39,40];if(-1==t.inArray(i.keyCode,n)){var s,r=this,a=i.target.selectionStart,o=i.target.selectionEnd,l="";setTimeout(function(){var t=r.textarea.val(),n=r.get("startTyping");(n||""!=t)&&(n=!0,n&&""==t&&(n=!1),r.set("startTyping",n),a!=o&&8==i.keyCode?s="del_range":i.ctrlKey&&86==i.keyCode||i.ctrlKey&&89==i.keyCode||i.ctrlKey&&90==i.keyCode?(s="paste",l=t):i.ctrlKey&&65==i.keyCode?s="del_all":8!=i.keyCode?(s="add",l=t.charAt(a)):8==i.keyCode&&(s="del"),e.app.socket.send("clientPostTyping",{word:l,action:s,pos_start:a,pos_end:o}))},0)}}},send_fom:function(t){var i="disabled",n=jSH(t.target).attr(i);if(n!=i){var s=jSH(t.target).parent("[rel=form]"),r=e.app.get_form_data(s);r&&(s.find("[rel=form_button]").attr(i,i),r.data=r.fields,"basy"==s.data("type")?(r.ent_id=e.WS.widget_id,r.cli_id=e.caches.get("cliId"),r.token=e.caches.get("token"),r.page_url=e.WS.href,e.IOApi("api()/esapi/chat/basy/",JSON.stringify(r),function(){s.html(e.$tmpl("sh_bill_ready",{text:e.i18n.l37}))})):"start"==s.data("type")?(e.WS.form_text=r.text,e.app.widget.init_online()):e.app.socket.send("clientSendForm",r))}},form_result:function(t){var i=t.formId,n=this.messages.find("[data-id=sh_form_"+i+"]").last(),s=n.find("[rel=apidescription]"),r=n.data(),a=t.description;if("error"!=t.result||a||(a="API service not responded"),s.removeClass("sh_form_result_success sh_form_result_error").addClass("sh_form_result_"+t.result).text(a||"").show(),e.app.widget&&(e.app.widget.$el.find("[rel=footer]").show(),e.app.widget.resize()),"success"==t.result)if(r.step+=1,r.steps.length<=r.step){var o=a||e.i18n.l37;n.html(e.$tmpl("sh_bill_ready",{text:o}))}else"current"!=t.next&&e.app.set_form_step(n,r.step);n.find("[rel=form_button]").removeAttr("disabled"),this.scroll_end()},form_fields:function(t){var i=t.step-1,n=this.messages.find("[rel=form]").last(),s=n.data();s.steps[i].api_fields=!1,s.steps[i].fields=t.data,e.app.set_form_step(n,i),this.scroll_end()},add_form:function(t){this.answer_timeout(!1);var i=e.app.create_form(t);this.messages.append(i),this.scroll_end()},add_message:function(i){var n=this.messages;i.time=e.date.get(i.unixtime,"hh:ii"),i.isHTML||(i.text=(i.text||"").toMessage()),i.files=(i.files||"").toFiles();var s=this.get("last_acc_id"),r=i.selId?"sel":"cli",a=r+i.acc_id;if(t("#sh_typing").remove(),s==a){var o=e.$tmpl("sh_message_text",i);n.children().last().find("[rel=text]").append(o)}else{var o=e.$tmpl("sh_message",i);n.append(o)}this.answer_timeout(i.selId?!1:!0),this.scroll_end(a)},add_history:function(t){var i=this.messages.find("[rel=history]");t.isHTML||(t.text=(t.text||"").toMessage()),t.files=(t.files||"").toFiles(),t.time=e.date.get(t.unixtime,"hh:ii"),i.after(e.$tmpl("sh_message",t))},show_hypertext:function(i){var n=t(i.target);if(n.data("show"))return n.next().remove(),void n.data("show",0);n.data("show",1);var s=n.attr("word"),r=new RegExp(s,"i"),a=e.caches.get("hypertext");if(a)for(var o in a)if(-1!=a[o].words.search(r)){var l=a[o].hint.replace(/(<([^>]+)>)/gi,""),c=a[o].url;return void("{{EXCHANGE_RATE}}"==l||n.after(e.$tmpl("sh_ht_hint",{word:s,hint:l.toMessage(),url:c})))}},seller_typing:function(i){i.status?(i.text=e.i18n.l36,this.messages.append(e.$tmpl("sh_typing",i)),this.messages.get(0).scrollTop=1e7):t("#sh_typing").remove()},add_bill:function(t){t.url=e.HOST+t.url.replace("orderredirect","payapi/pay"),this.messages.append(e.$tmpl("sh_bill",t)),this.scroll_end()},render_bill_email:function(i){var n=t(i.target).parents("[rel=bill]");n.html(e.$tmpl("sh_bill_email")),this.scroll_end()},bill_done:function(t){var i=this.$el.find('[data-id="'+t.billId+'"]');i.html(e.$tmpl("sh_bill_ready",{text:e.i18n.l32_1}))},send_bill_email:function(i){var n=t(i.target).parents("[rel=bill]"),s=n.find("input").val();return e.isEmail(s)?(e.app.writer.clientSendBill(s,parseInt(n.data("id"))),n.html(e.$tmpl("sh_bill_ready",{text:e.i18n.l32})),void this.scroll_end()):void alert(e.i18n.l10)},get_history:function(){var t=e.caches.get("h_offset")||0;e.app.writer.clientPrevHistory(t),e.caches.set("h_offset",++t)},send_first_message:function(){e.WS.first_client_message&&(this.textarea.val(e.WS.first_client_message),this.$el.find("[rel=enter]").trigger("click"))},set_textarea_width:function(){this.textarea.width(this.textarea.parent().width()-parseInt(this.textarea.css("padding-left"))+"px")}});e.ui.Online=e.Controller({init:function(t){e.app.guests&&e.app.guests.close(),this.model=new i(t),e.app.view=new n(this.model)}})}(SH,jSH),function(e,t){e.ui.Divisions=e.View({events:{"click [rel=division]":"click"},init:function(){e.app.view=this,this.$el=e.$tmpl("sh_divisions",{});var i=this;e.IOApi("api()/esapi/chat/getdivisions/",{entId:e.WS.widget_id},function(n){t(n.data).map(function(){i.$el.append(e.$tmpl("sh_divisions_row",this))})})},click:function(i){e.WS.init_widget_id=e.WS.widget_id;var n=t(i.target).data("id");e.WS.widget_id=parseInt(n),e.caches.set("entId",e.WS.widget_id),e.app.widget.init_online()}})}(SH,jSH),function(e){e.ui.Form=e.View({events:{"click [rel=form_button]":"click"},init:function(t){e.app.view=this,this.$el=e.$tmpl("sh_offline_box"),t?this.show_form(t):this.load_form(e.WS.form_start)},load_form:function(t){var i=this;e.IOApi("api()/esapi/chat/getform/",{entId:e.WS.widget_id,formId:t},function(n){n&&n.steps?(n.formId=t,i.show_form(n)):e.app.widget.init_online()})},show_form:function(t){var i=e.app.create_form(t);this.$el.append(i)},click:function(t){var i="disabled",n=jSH(t.target).attr(i);if(n!=i){var s=jSH(t.target).closest("[rel=form]"),r=e.app.get_form_data(s);r&&(s.find("[rel=form_button]").attr(i,i),e.WS.form_text=r.text,e.app.widget.init_online())}}})}(SH,jSH),String.prototype.stripHTML=function(e){var t=this||"";return e?t.replace(/(<([^>]+)>)/gi,"").replace(/'/g,"&#039;").replace(/"/g,"&quot;"):t.replace(/(<([^>]+)>)/gi,"")},String.prototype.stripXSS=function(){return this.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")},String.prototype.replaceAll=function(e,t){return this.split(e).join(t)},String.prototype.fromBBCode=function(){var e=this.stripXSS();return e=e.replace(/(\[\/?)([^\]\s]*)([^\]]*)(\])/gi,function(e,t,i,n){return jSH.inArray(i,["p","div","b","i","ul","ol","li","br"])<0?e:t.replace(/^\[/gi,"<")+i+n+">"}).replace(/(\[url=)([^\]\s]*)([^\]]*)(\])([\s\S]*?)(\[\/url\])/gi,function(e,t,i,n,s,r){return'<a href="'+i+'"'+n+' target="_blank">'+r+"</a>"}).replace(/(\[img)([^\]]*)(\])([\s\S]*?)(\[\/img\])/gi,function(e,t,i,n,s){return"<img src="+s+i+">"}).replace(/(<\/?)([^>\s]*)([^>]*)(>)/gi,function(e,t,i,n,s){var r="";return n=n.split(" "),jSH.each(n,function(e,t){t.search(/^(href|src|width|height|target)=/gi)>=0&&(r+=" "+t.replace(/=(['"]?)(\S*?)(['"]?)$/gi,'="$2"'))}),t+i+r+s})},String.prototype.toMessage=function(){var e=this||"";e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/gi,"<br/>");try{}catch(t){}var i=/(\b(https?|ftp):\/\/[-A-ZА-Я0-9+&@#\/%?=~_|!:,.;]*[-A-ZА-Я0-9+&@#\/%=~_|])/gim;e=e.replace(i,'<a class="shc sh_a" href="$1" target="_blank">$1</a>');var n=/(^|[^\/])(www\.[\S]+(\b|$))/gim;e=e.replace(n,'$1<a class="shc sh_a" href="http://$2" target="_blank">$2</a>');var s=/([a-zA-Z0-9_\-\.]+)@([a-zA-Zа-яА-Я0-9_\-\.]+)\.([a-zA-Zа-яА-Я]{2,6})/gim;return e=e.replace(s,' <a class="shc sh_a" href="mailto:$1@$2.$3">$1@$2.$3</a> '),e.toSHSmiles().toHyperText()},String.prototype.toFiles=function(){var e=this||"";if(!e||""==e)return"";var t;try{t=JSON.parse(e)}catch(i){return""}var n=jSH('<div class="shc"></div>');return jSH(t).map(function(){var e=this;e.href=e.href.stripHTML().replace("https:","").replace("http:",""),e.name=e.name.stripHTML(),e.type=e.type.stripHTML(),e.size=SH.bytes(e.size),n.append(SH.$tmpl("sh_message_file",e))}),n.html()},String.prototype.toSHSmiles=function(){var e=this||"";if(!e||""==e)return"";for(var t=SH.SMILES,i=0;i<t.length;i++){var n=t[i];e=e.replaceAll("(:"+n+":)",'<div class="shc sh_smile sh_smile_img" data-name="'+n+'"></div>')}return e},String.prototype.toHyperText=function(){var e=this;if(!e.length)return e;var t=SH.caches.get("hypertext");if(!t)return e;var i;try{for(var n=0;n<t.length;n++){var s=t[n],r=s.words.split(",");if(""!=t[n].hint)for(var a=0;a<r.length;a++)i+="|"+jSH.trim(r[a]);else delete t[n]}}catch(o){return console.log(o),e}try{var l=new RegExp("(^|[ \n\r	.,'\"+!?-]+)("+i+")([ \n\r	.,'\"+!?-]+|$)","i");return e.replace(l,function(e,t,i,n){return t+"<span rel='hypertext' class='shc sh_hypertext_word' word='"+i+"'>"+i+"</span>"+n})}catch(o){return e}},SH.date={get:function(e,t){var i=e?new Date(1e3*e):new Date;return SH.date.date(i,t)},date:function(e,t){if(t=t?t:"hh:ii dd.mm.yy","auto"==t){var i=new Date;t=e.getDate()==i.getDate()&&e.getMonth()==i.getMonth()&&e.getFullYear()==i.getFullYear()?"hh:ii":"hh:ii dd.mm.yy"}var n=e.getHours(),s=e.getMinutes(),r=e.getSeconds(),a=e.getDate(),o=e.getMonth();return n=10>n?"0"+n:n,s=10>s?"0"+s:s,r=10>r?"0"+r:r,a=10>a?"0"+(a>1?a:1):a,o=10>o?"0"+(o+1):o+1,t=t.replace("hh",n),t=t.replace("ii",s),t=t.replace("ss",r),t=t.replace("dd",a),t=t.replace("mm",o),t=t.replace("yy",e.getFullYear())}},SH.templates.push('<t name="sh_btn"><div id="sh_button" class="shc sh_btn sh_btn_{{!it.side}} sh_btn_{{!it.side}}_{{!it.position}}"><img rel="logo" style="margin: 6px;" class="shc sh_logo_btn sh_logo_img" src="{{!SH.DIR}}/img/logo.png" /><div class="shc sh_title_text" rel="title">{{? SH_GP_ONLINE}}{{!it.title}}{{??}}{{!it.title_offline}}{{?}}</div><div class="shc sh_block_counter" title=\'{{t "l49"}}\'><span rel="counter">0</span></div>{{? SH.WS.verified}}<div class="shc sh_pay_logo"><div class="shc sh_pay_box"><div class="shc sh_visa_logo"></div><div class="shc sh_pay_box_title">{{t "l33"}} </div><div class="shc sh_pay_box_description">{{t "l34"}} </div><div class="shc sh_triangle"></div><div class="shc sh_triangle_white"></div></div></div>{{?}}</div></t><t name="sh_btn_invite"><div rel="invite" class="shc sh_operator_help"><div class="shc sh_operator_close"><div rel="invite_close" class="shc sh_operator_close_img"></div></div><div class="shc sh_operator_logo"><img rel="avatar" class="sh_chat_operator_logo" src="{{!it.avatar}}" ></div><div class="shc sh_operator_title">{{!it.nick}}</div><div class="shc sh_operator_description">{{!it.text}}</div><div class="shc sh_clear"></div><div rel="invite_no" class="shc sh_operator_button_no">{{t "l50"}}</div><div rel="invite_yes" class="shc sh_button sh_operator_button_save">{{t "l51"}}</div><div class="shc sh_operator_triangle"></div><div class="shc sh_operator_triangle_white"></div></div></t><t name="sh_btn_char"><div class="shc sh_btn_char">{{!it.char}} </div></t><t name="sh_btn_char_trans"><div class="shc sh_btn_char_trans">{{!it.char}}</div></t><t name="sh_chat"><div class="shc sh_chat"><div class="shc sh_header" rel="header"><div class="shc sh_top_buttons"><div rel="close" class="shc sh_hico sh_hico_close" title=\'{{t "l52"}}\'></div><div rel="popup" class="shc sh_hico sh_hico_popup" title=\'{{t "l53"}}\'></div><div rel="hide" class="shc sh_hico sh_hico_hide" title=\'{{t "l54"}}\'></div></div><div class="shc sh_header_info"><img rel="logo" class="sh_chat_logo" style="margin: 8px;float:left" src="{{!SH.DIR}}/img/logo.png" /><div class="shc sh_title" rel="title">{{? SH_GP_ONLINE}}{{!it.title}}{{??}}{{!it.title_offline}}{{?}}</div></div></div><div id="sh_container_root" class="shc sh_scrollbar" rel="scrollbar"><div id="sh_container" class="shc sh_container"></div></div>{{include "sh_copyright"}}</div></t><t name="sh_copyright"><div class="shc sh_copyright" rel="copyright">{{include "sh_resize"}} <a href="http://www.siteheart.com" target="_blank" title="SiteHeart" class="shc"><span class="shc sh_copyright_text">{{t "l2"}} </span><span class="shc">Site</span>Heart</a></div></t><t name="sh_resize"><div class="shc sh_resize" rel="resize"></div></t>'),SH.templates.push('<t name="sh_online_box"><div class="shc sh_online_box" rel="online"><div id="sh_messages" class="shc sh_messages sh_scrollbar" rel="scrollbar"></div></div> {{include "sh_footer"}}</t><t name="sh_history_btn"><div rel="history" class="shc sh_history_btn">{{t "l60"}} ↑</div></t><t name="sh_footer"><div class="shc sh_footer" rel="footer"><div class="shc sh_footer_menu_list"><div class="shc sh_button sh_button_back sh_button_gray_complete" rel="complate">{{t "l20"}}</div><div class="shc sh_footer_menu" rel="attach" title=\'{{t "l41"}}\'><div class="shc sh_ic sh_ic_attach"></div></div><div class="shc sh_footer_menu" rel="smiles" title=\'{{t "l42"}}\'><div class="shc sh_ic sh_ic_smiles"></div></div><div class="shc sh_footer_menu" rel="sound" title=\'{{t "l43"}}\'><div class="shc sh_ic sh_ic_sound"></div></div></div><div class="shc sh_textarea_answer" rel="answer_form"><textarea class="shc" placeholder=\'{{t "l44"}}...\' name="text"></textarea><div class="shc sh_enter_ico" rel="enter" title=\'{{t "l45"}}\'></div></div></div></t><t name="sh_online_complate"><div class="shc sh_chat_end" rel="online_complate"><div class="shc sh_chat_title">{{t "l21"}} </div>{{include "sh_exit_vote"}}{{? SH.WS.chat_to_email}}{{include "sh_exit_email"}}{{?}}<div class="shc sh_button_field"><div rel="complate_back" class="shc sh_button sh_button_back">{{t "l26"}} </div><div rel="complate_save" class="shc sh_button sh_button_save">{{t "l27"}} </div></div></div></t><t name="sh_exit_vote"><div class="shc"><div class="shc sh_chat_description">{{t "l22"}} </div><div class="shc sh_chat_decision"><div class="shc sh_chat_radio"><input class="shc" type="radio" name="decision"><div rel="vote" data-vote="yes" class="shc sh_chat_vote">{{t "l23"}} </div></div><div class="shc sh_chat_radio"><input class="shc" type="radio" name="decision"><div rel="vote" data-vote="no" class="shc sh_chat_vote">{{t "l24"}} </div></div><div rel="vote_contacts" class="shc sh_hide"><div class="shc sh_chat_question">{{t "l46"}}</div>{{? SH.WS.contact_email}}<div class="shc sh_form_field" ><input rel="exit_contact_email" class="shc sh_input" type="text" placeholder="E-mail" /></div>{{?}}{{? SH.WS.contact_phone}}<div class="shc sh_form_field"><input rel="exit_contact_phone" class="shc sh_input" type="text" placeholder=\'{{t "l47"}}\' /></div>{{?}}{{? SH.WS.contact_comment}}<div class="shc sh_form_field_textarea" ><textarea rel="exit_contact_comment" class="shc sh_textarea" placeholder=\'{{t "l48"}}\'></textarea></div>{{?}}</div></div></div></t><t name="sh_exit_email"><div class="shc"><div class="shc sh_chat_question">{{t "l25"}} </div><div class="shc sh_chat_fields"><div class="shc sh_form_field"><input rel="exit_email" class="shc sh_input" type="text" placeholder="E-mail" /></div></div></div></t><t name="sh_smiles_box"><div class="shc sh_smiles"><div class="shc sh_point"></div>{{ for(var i in SH.SMILES) { }}<div class="shc sh_smile_menu"><div class="shc sh_smile sh_smile_icon" rel="smile" data-name="{{!SH.SMILES[i]}}"></div></div>{{ } }}</div></t><t name="sh_wait_connection"><div rel="wait" class="sh_wait_connection">{{!it.text}}</div></t><t name="sh_message"><div class="shc sh_message"><div class="shc sh_photo"><img class="sh_avatar" src="{{!SH.API_HOST}}/esapi/avatar/small/{{!it.acc_id || \'0\'}}"></div><div class="shc sh_mess_content"><div class="shc sh_mess_details"><div class="shc sh_mess_time">{{!it.time}}</div><div class="shc sh_mess_nick{{? it.selId}} sh_mess_nick_sel{{?}}">{{!it.nick}}</div></div><div class="shc" rel="text">{{include "sh_message_text"}} </div></div><div class="shc sh_clear"></div></div></t><t name="sh_typing"><div id="sh_typing" class="shc sh_typing">{{!it.nick}} {{!it.text}} </div></t><t name="sh_message_text"><div id="sh_{{!it.id}}" class="shc sh_mess_text">{{=it.text}}{{=it.files}}</div></t><t name="sh_message_file">{{? it.type == \'image\'}}<div class="sh_file"><a href="{{!it.href}}" target="_blank" ><img src="{{!it.href}}" title="{{!it.name}}" alt="{{!it.name}}"/></a></div>{{??}}<div class="sh_file sh_file_icon sh_file_icon_{{!it.type}}"><a href="{{!it.href}}" target="_blank" >{{!it.name}} {{!it.size}}</a></div>{{?}}</t><t name="sh_ht_hint"><div rel="ht_hint" class="shc sh_ht_hint">“<b>{{!it.word}}</b>” — {{=it.hint}} {{? it.url}} <a href="{{=it.url}}" target="_blank" class="shc sh_ht_url"> ...→ </a> {{?}}</div></t><t name="new_chat_btn"><div class="shc sh_button sh_button_back" rel="new_chat_btn" style="float:none;width:200px;margin:0 auto;">{{t "Начать новый диалог"}}</div></t>'),SH.templates.push('<t name="sh_history"><div class="shc sh_divisions" ><div class="shc sh_form_logo_history"><img src="./img/logo_history.png"></div><div class="shc sh_form_title_history">{{t "l55"}}</div><div rel="" class="shc sh_button">{{t "l56"}}</div><div class="shc sh_button sh_button_back sh_button_big_gray">{{t "l57"}}<div class="shc sh_button_history_number">5</div></div></div></t><t name="sh_divisions"><div class="shc sh_divisions" ><div class="shc sh_form_title">{{t "l3"}} </div><div class="shc sh_form_description">{{t "l9"}} </div></div></t><t name="sh_divisions_row"><div rel="division" class="shc sh_button" data-id="{{!it.ent_id}}">{{!it.title}}</div></t><t name="sh_offline_box"><div class="shc sh_offline"></div></t><t name="sh_offline_done"><div class="shc sh_offline_done"><div class="shc sh_letter_img"></div><div class="shc sh_successfully">{{t "l17"}} </div><div class="shc sh_message_sent">{{t "l18"}} </div><div rel="close" class="shc sh_button">{{t "l19"}} </div></div></t><t name="sh_form"><div rel="form" class="shc sh_form" data-id="sh_form_{{!it.formId}}" data-type="{{!it.type}}">{{ for(var i=0; i<it.steps.length; i++) { }}<div rel="step" class="shc sh_form_step"><span>{{! (parseInt(i)+1) }}.</span> {{!it.steps[i].title}}</div>{{ } }}<div class="sh_clear"></div><div rel="description" class="shc sh_form_description"></div><div rel="fields" class="shc sh_form_fields"></div><div rel="form_button" class="shc sh_button">{{t "l16"}}</div><div rel="apidescription" class="shc sh_form_result"></div></div></t><t name="sh_form_input"><div rel="field" class="shc sh_form_field sh_form_field_{{!it.type}}">{{? it.type == \'text\'}}<input type="text" class="shc sh_input" placeholder="{{!it.title}}" title="{{!it.title}}" />{{?? it.type == \'password\'}}<input type="password" class="shc sh_input" placeholder="{{!it.title}}" title="{{!it.title}}" />{{?? it.type == \'hidden\'}}<input type="hidden" value="{{!it.value}}"/>{{?? it.type == \'date\'}}<input type="date" class="shc sh_input" placeholder="{{!it.title}}" title="{{!it.title}}" />{{??}}<div class="shc sh_form_label">{{!it.title}}:{{? it.required}}<sup class="shc">*</sup>{{?}}</div>{{ for(var i=0; i<it.values.length; i++) { }}<div class="shc sh_form_choise"><input class="shc" type="{{!it.type}}" name="field{{!it.field_id}}" value="{{!it.values[i].value}}" /><span class="shc">{{!it.values[i].title}}</span></div>{{ } }}{{?}}</div></t><t name="sh_form_textarea"><div rel="field" class="shc sh_form_field_textarea"><textarea class="shc sh_textarea" placeholder="{{!it.title}}" title="{{!it.title}}"></textarea></div></t><t name="sh_form_select"><div rel="field" class="shc sh_form_field sh_form_field_select"><div class="shc sh_form_label">{{!it.title}}:{{? it.required}}<sup class="shc">*</sup>{{?}}</div><select class="shc sh_form_select">{{ for(var i=0; i<it.values.length; i++) { }}<option class="shc" value="{{!it.values[i].value}}">{{!it.values[i].title}}</option>{{ } }}</select></div></t>'),SH.templates.push('<t name="sh_bill"><div rel="bill" class="shc sh_bill" data-id="{{!it.billId}}"><div class="shc sh_bill_content"><div class="shc sh_form_title">{{!it.shortdescr}}</div><div class="shc sh_form_description">№ {{!it.entId}}-{{!it.billId}} <br /> {{!it.descr}}</div><div class="shc sh_bill_payment"><div class="shc sh_bill_amount">{{!it.price}} {{!it.currency}}</div><div class="shc sh_bill_logo"></div></div><div rel="bill_email" class="shc sh_button sh_botton_bill sh_button_back">{{t "l29"}}</div><div class="shc sh_button sh_botton_bill"><a class="shc" href="{{!it.url}}" target="_blank">{{t "l30"}}</a></div></div></div></t><t name="sh_bill_email"><div class="shc"><div class="shc sh_bill_description">{{t "l31"}}</div><div class="shc sh_bill_content"><div class="shc sh_form_field sh_bill_field"><input name="email" class="shc sh_input" type="text" placeholder="E-mail"></div><div rel="bill_email_send" class="shc sh_button sh_botton_bill">{{t "l16"}} </div></div></div></t><t name="sh_bill_ready"><div class="shc sh_bill_description">{{=it.text}}</div></t>'),function(e){e.language="cz";var t=e.i18n;t.l1="Online pomoc",t.l2="Powered by",t.l3="Vstup do konverzace",t.l4="Přihlaste se prosím pro uložení historie konverzace.",t.l5="Profil Facebook",t.l6="Profil Twitter",t.l7="Profil Google",t.l8="Vstoupit bez přihlášení",t.l9="Zvolte sekci:",t.l10="Zadejte správný tvar e-mailové adresy",t.l11="Zadejte text zprávy",t.l12="Prosím, vyplňte všechna povinná pole",t.l14="Nejsme online.",t.l15="Prosíme Vás o zanechání svých kontaktních údajů a Vašeho dotazu. Obratem Vás budeme kontaktovat!",t.l16="Odeslat",t.l17="Děkujeme!",t.l18="Zpráva byla odeslána.",t.l19="Zavřít okno",t.l20="Ukončit",t.l21="Konverzace byla ukončena",t.l22="Byl Váš problém vyřešen?",t.l23="Ano, byl vyřešen",t.l24="Ne, nebyl vyřešen",t.l25="Uložit historii konverzace?",t.l26="Zpět",t.l27="Uložit a zavřít",t.l28="Spojení s operátorem",t.l29="Zaplatit později",t.l30="Zaplatit okamžitě",t.l31="Prosíme Vás o zadání e-mailu, <br/> na který odešleme informace <br/> pro dokončení platby.",t.l32="Úspěšně dokončeno! <br/> Informace byly odeslány na <br/> Váš e-mail.",t.l32_1="Děkujeme! <br/> Částka byla úspěšně zaplacena.",t.l33="Zástupce společnosti",t.l34="V tomto chatu můžete zaplatit za nákup kartami VISA/MasterCard.",t.l35="Vy",t.l36="píše zprávu...",t.l37="Děkujeme! <br/> Formulář byl úspěšně odeslán.",t.l38="Spojení se serverem",t.l39="Odeslat zprávu",t.l40="Dobrý den, mohu Vám nějak pomoci?",t.l41="Odeslat soubor",t.l42="Smajlík",t.l43="Hlasitost",t.l44="Zadejte text zprávy",t.l45="Odeslat",t.l46="Zanechte prosím svoje kontaktní údaje a my se Vám obratem ozveme.",t.l47="Telefon",t.l48="Komentář",t.l49="Návštěvníků webu",t.l50="Ne",t.l51="Ano",t.l52="Ukončit konverzaci",t.l53="Otevřít v novém okně",t.l54="Minimalizovat",t.l55="Vítejte!",t.l56="Zahájit konverzaci",t.l57="Prohlédnout historii",t.l58="Představte se prosím",t.l59="Váš dotaz",t.l60="Historie"}(SH),function(e){e.language="de";var t=e.i18n;t.l1="Onlinehilfe",t.l2="Präsentiert von",t.l3="Melde dich an, Chat",t.l4="Bitte melden Sie sich an, um Gesprächsverlauf zu speichern.",t.l5="Facebook Account",t.l6="Twitter Account",t.l7="Google Account",t.l8="Anmelden ohne Autorisierung",t.l9="Bitte wählen Sie eine Abteilung:",t.l10="Bitte geben Sie eine gültige E-Mail",t.l11="Bitte geben Sie Ihre Nachricht",t.l12="Bitte füllen Sie alle Pflichtfelder",t.l14="Wir sind offline.",t.l15="Bitte hinterlassen Sie Ihre Kontaktdaten und Ihre Frage, wir werden Sie umgehend kontaktieren!",t.l16="Senden",t.l17="Danke!",t.l18="Nachricht wurde gesendet.",t.l19="Fenster schließen",t.l20="Beenden",t.l21="Dialog ist beendet",t.l22="Ist Ihre Problem gelöst?",t.l23="Ja, gelöst",t.l24="Nein, nicht gelöst",t.l25="Speichern der Dialog?",t.l26="Zurück",t.l27="Speichern und Abmelden",t.l28="Verbindung mit einem Operator",t.l29="Später bezahlen",t.l30="Jetzt bezahlen",t.l31="Bitte geben Sie Ihre E-Mail, <br/> um eine Rechnung <br/> zu erhalten.",t.l32="Fertig!<br/> Die Rechnung erfolgreich an die angegebene <br/> E-Mail zugeschickt.",t.l32_1="Danke!<br/> Die Rechnung erfolgreich bezahlt.",t.l33="Eine vertraute Geschäftsmann",t.l34="In diesem Chat können Sie mit Karten VISA/MasterCard zahlen.",t.l35="Sie",t.l36="tippt eine Meldung ...",t.l37="Danke! <br/> Formular wurde gesendet.",t.l38="Verbindung mit Server",t.l39="Eine Nachricht hinterlassen",t.l40="Hallo, kann ich Ihnen helfen?",t.l41="Senden einer Datei",t.l42="Smiley",t.l43="Ertönen",t.l44="Geben Sie Ihre Nachricht",t.l45="Senden",t.l46="Bitte hinterlassen Sie Ihre Kontaktdaten und wir werden Sie kontaktieren.",t.l47="Telefonieren",t.l48="Kommentar",t.l49="Die Besucher der Website",t.l50="Nein",t.l51="Ja",t.l52="Gespräch beenden",t.l53="Öffnen Sie in einem neuen Fenster",t.l54="Drehen",t.l55="Willkommen zurück!",t.l56="Chat starten",t.l57="Sehen Sie Geschichte",t.l58="Stellen Sie sich vor",t.l59="Ihre Frage",t.l60="Geschichte"}(SH),function(e){e.language="en";var t=e.i18n;t.l1="Live Help",t.l2="Powered by",t.l3="Login to Chat",t.l4="Please log in to save conversation history.",t.l5="Facebook Account",t.l6="Twitter Account",t.l7="Google Account",t.l8="Login without authorization",t.l9="Please choose a department:",t.l10="Please enter a valid E-mail",t.l11="Please enter your message",t.l12="Please fill in all mandatory fields",t.l14="We are offline.",t.l15="Please leave your contact and your question, we'll contact you!",t.l16="Send",t.l17="Thank you!",t.l18="Message sent.",t.l19="Close the window",t.l20="Finish",t.l21="Dialog is completed",t.l22="Your problem is solved?",t.l23="Yes, solved",t.l24="No, not solved",t.l25="Save dialog?",t.l26="Back",t.l27="Save and Exit",t.l28="Connecting to operator",t.l29="Pay later",t.l30="Pay Now",t.l31="Please specify E-mail,<br/> which will be sent an invoice <br/>for payment.",t.l32="Done!<br/> The bill was successfully sent to the <br/>specified E-mail.",t.l32_1="Thank you!<br/> The score is successfully paid.",t.l33="A trusted businessman",t.l34="In this chat you can pay cards VISA/MasterCard.",t.l35="You",t.l36="is typing a message ...",t.l37="Thank you!<br/> Form has been sent.",t.l38="Connect to Server",t.l39="Leave a message",t.l40="Hello, can I help you?",t.l41="Submit a file",t.l42="Smile",t.l43="Sound",t.l44="Enter your message",t.l45="Send",t.l46="Please leave your contact details and we will contact you.",t.l47="Phone",t.l48="Comment",t.l49="Visitors to the site",t.l50="No",t.l51="Yes",t.l52="Finish",t.l53="Open in a new window",t.l54="Minimize",t.l55="Welcome back!",t.l56="Start Chat",t.l57="View history",t.l58="Name",t.l59="Your question",t.l60="History"}(SH);
//# sourceMappingURL=widget.map
SH.setWS({"widget_id":631144,"hide_offline":true,"invite_text":"Помочь с задачей?","invite_cancel_timeout":60000,"invite_timeout":60000,"title_offline":"Оставить сообщение","title":"Задать вопрос","position":"right","side":"bottom","template":"orange"});SH.VERSION='201508061207';SH.SVERSION='1';SH.appInit();